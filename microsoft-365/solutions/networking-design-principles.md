---
title: ネットワークアップ (クラウドまで) - 1 人のアーキテクトの視点
description: 最も一般的な落とし穴を回避して、クラウド接続のためにネットワークを最適化する方法について説明します。
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
localization_priority: Normal
ms.collection:
- M365-identity-device-management
- M365-security-compliance
ms.custom: ''
f1.keywords: NOCSH
ms.openlocfilehash: f1d3bcf269211dc00702c08c22ff0c6f6055b1b63f6bfd351d5aba7679b82978
ms.sourcegitcommit: a1b66e1e80c25d14d67a9b46c79ec7245d88e045
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/05/2021
ms.locfileid: "53804752"
---
# <a name="networking-up-to-the-cloudone-architects-viewpoint"></a>ネットワークアップ (クラウドまで) - 1 人のアーキテクトの視点

この記事では、Microsoft のセキュリティ & コンプライアンス アーキテクトである [Ed Fisher](https://www.linkedin.com/in/edfisher/)で、最も一般的な落とし穴を回避して、クラウド接続用にネットワークを最適化する方法について説明します。 

## <a name="about-the-author"></a>筆者について

![Ed Fisher の写真](../media/solutions-architecture-center/ed-fisher-networking.jpg) 

現在は、セキュリティとコンプライアンスに重点を置く、東南地域のプリンシパル テクニカル スペシャリスト&しています。 過去 10 年間、顧客が Office 365をサポートしてきました。 私は、数百万人のユーザーが世界中に分散している政府機関や企業、その間に他の多くの顧客にいくつかの場所を持つ小規模なショップと協力し、その間に多数のユーザー、世界中のさまざまな場所に複数の場所を持ち、より高いセキュリティの必要性、多数のコンプライアンス要件を満たしています。 何百もの企業と何百万人ものユーザーが安全かつ安全にクラウドに移行するのに役立っています。

過去 25 年間にわたり、セキュリティ、インフラストラクチャ、ネットワーク エンジニアリングを含むバックグラウンドを持ち、Microsoft に入社する前に 2 人の以前の雇用主を Office 365 に移した後、何度もテーブルの横にいて、そのことを覚えておいてください。 同じ顧客は 2 人もいなかっていますが、ほとんどが同様のニーズを持ち、SaaS や PaaS プラットフォームなどの標準化されたサービスを利用する場合、最適なアプローチは同じになる傾向があります。

## <a name="its-not-the-networkits-how-youre-misusing-it"></a>ネットワークではなく、(誤って)使用している方法です。

何回起こっても、クリエイティブなセキュリティ チームとネットワーク チームがMicrosoft クラウド サービスに接続する必要があるという考え方に驚かされるのは決してありません。 セキュリティ ポリシー、コンプライアンス標準、または使用を主張する優れた方法が常にいくつかあります。その方法は、何を達成しようとしているか、また、より優れた方法、より簡単で、コスト効率が高く、パフォーマンスの高い方法に関する会話に積極的に取り組む必要が生じることなく行います。

この種のことがエスカレートすると、通常はチャレンジして、その方法と理由を順を見て、必要な場所に進んで行く必要があります。 しかし、私が完全に率直である場合、私は時々、彼らがやるのをやらせたいので、彼らが最終的に譲歩してもうまくいかないと言ったと言って戻ってくることを共有する必要があります。 私は時々それをしたいと思うかもしれませんが、*私はそうは思ってはい.* 私が行うのは、この投稿に含める内容のすべてについて説明しようとします。 役割に関係なく、組織が Microsoft クラウド サービスを使用する場合は、次に示す知識が役立つ可能性があります。

## <a name="guiding-principles"></a>ガイドの原則

ここでは、ここで行っていることに関するいくつかのグラウンド ルールから始め、次に示します。 実際のセキュリティを維持しながら、最小限の複雑さ、最大のパフォーマンスを確保するために、クラウド サービスに安全に接続する方法について説明します。 次に示す方法は、お客様や顧客が、お気に入りのプロキシ サーバーをすべてのユーザーに使用できない場合でも、それに対抗する方法は何もありません。

- **できるからと** いって、ジュラシック パーク映画 "..からイアン・マルコム博士を言い換えるべきという意味で、そうする必要があります。はい、はい、しかし、セキュリティ チームは、セキュリティ チームが必要かどうかを考えるのをやめなかったかどうかに非常に気が付きました。
- **セキュリティは複雑さを意味する** 意味ではありません:より多くのお金を使う、より多くのデバイスをルーティングする、または他のボタンをクリックしたからといって、より安全ではありません。
- **Office 365インターネット** を通してアクセスされる場合: しかし、これはインターネットOffice 365とは異なっています。 Microsoft が管理し、ユーザーが管理する SaaS サービスです。 インターネット上でアクセスする Web サイトとは異なり、実際にはカーテンの後ろを覗き込み、ポリシーとコンプライアンス基準を満たすために必要なコントロールを適用できます。目標を達成できる限り、別の方法で行う必要がある場合があります。
- チョークポイントは悪く、ローカライズされたブレークアウトは良好です:すべてのユーザーに対してすべてのインターネット トラフィックを常にバックホールして、通常はポリシーを適用することができますが、多くの場合、すべての場所でインターネット アクセスをプロビジョニングするよりも安価なので、すべてのユーザーに対してすべてのインターネット トラフィックをバックホールしたいと考える場合があります。 しかし、これらのチョークポイントはまさにそれです。..トラフィックが詰め込むポイント。 ユーザーがInstagramを閲覧したり、猫のビデオをストリーミングしたりするのを防ぐことには何の問題もありませんが、ミッションクリティカルなビジネス アプリケーショントラフィックを同じ方法で扱う必要もありません。
- **DNS ain t happy, ain't** nothing happy: 最適な設計されたネットワークは、世界の他の領域のサーバーへの要求を再帰するか、ISP の DNS サーバーまたは DNS 解決情報をキャッシュする他のパブリック DNS サーバーを使用して、貧しい DNS によって解決される可能性があります。
- **そうやった** からといって、今はそうする必要があるという意味ではありません。テクノロジは常に変化し、Office 365も例外ではありません。 オンプレミス サービス用に開発および展開されたセキュリティ対策を適用したり、Web サーフィンを制御したりすると、同じレベルのセキュリティ保証を提供する必要はありません。パフォーマンスに大きな悪影響を及ぼす可能性があります。
- **Office 365インターネットを使用** してアクセスするために構築されたのは、簡単な説明です。 ユーザーとエッジの間で何をしたがっても、トラフィックはネットワークから離れ、ネットワークに接続する前にインターネット上に移動します。 Azure ExpressRoute を使用してネットワークから直接ネットワークに遅延に敏感なトラフィックをルーティングする場合でも、インターネット接続は絶対に必要です。 受け入れる。 考え過ぎないで下さい。

## <a name="where-bad-choices-are-often-made"></a>悪い選択が頻繁に行われた場合

セキュリティの名の下に悪い決定が下される場所はたくさんあるが、これらは私が最も頻繁に顧客と遭遇する場所です。 多くの顧客の会話には、これらすべてが同時に関係します。

### <a name="insufficient-resources-at-the-edge"></a>エッジでのリソース不足

グリーンフィールド環境を展開しているお客様は非常に少なく、ユーザーの動作とインターネット出力の種類に関して何年もの経験があります。 顧客は、プロキシ サーバーを持っている場合でも、直接アクセスを許可し、単に NAT 送信トラフィックを許可する場合でも、何年も前からそれを行い、従来の内部アプリケーションをクラウドに移行する際に、エッジからポンピングを開始する量を考慮しません。

帯域幅は常に懸念事項ですが、NAT デバイスでは負荷の増加を処理するのに十分な馬力が不足し、リソースを解放するために接続を途中で閉じ始める可能性があります。 クライアント ソフトウェアに接続するクライアント ソフトウェアの多Office 365永続的な接続が必要であり、ユーザーが永続的な接続を完全に利用Office 365 32 以上の同時接続が必要な場合があります。 NAT デバイスが途中で削除している場合は、不要になった接続を使用しようとして、それらのアプリが応答しなくなる可能性があります。 彼らはあきらめて新しい接続を確立しようとするときに、ネットワーク ギアにさらに負荷をかかします。

### <a name="localized-breakout"></a>ローカライズされたブレークアウト

このリストの他のすべては、ネットワークから離れ、可能な限り迅速に行うという 1 つの問題に関して行います。 ユーザーのトラフィックを中央の出力ポイントに戻す(特に、その出力ポイントがユーザーが含む地域以外の地域にある場合)、不要な待機時間が発生し、クライアント エクスペリエンスとダウンロード速度の両方に影響を与えます。 Microsoft は、実質的にすべての主要な ISP で確立されたすべてのサービスとピアリングのフロントエンドを備え、世界中にプレゼンスポイントを持っています。そのため、ユーザーのトラフィックをローカルにルーティングすることで、最小限の待機時間でネットワークに迅速に接続できます。

### <a name="dns-resolution-traffic-should-follow-the-internet-egress-path"></a>DNS 解決トラフィックは、インターネット出力パスに従う必要があります

もちろん、クライアントが任意のエンドポイントを見つけるには、DNS を使用する必要があります。 Microsoft の DNS サーバーは、DNS 要求のソースを評価して、要求のソースに最も近い応答 (インターネット用語) を返します。 名前解決要求がユーザーのトラフィックと同じパスに送信するように DNS が構成されていることを確認します。ローカル出力を与えるのではなく、別の地域のエンドポイントに送信します。 つまり、リモート データ センターの DNS サーバーに転送するのではなく、ローカル DNS サーバーを "ルート" に移動できます。 また、パブリックおよびプライベート DNS サービスに注意してください。これは、世界の一部からの結果をキャッシュし、世界の他の部分からの要求にサービスを提供する可能性があります。

### <a name="to-proxy-or-not-to-proxy-that-is-the-question"></a>プロキシまたはプロキシしない場合は、それが問題です

最初に考慮すべき点の 1 つは、ユーザーの接続をユーザーにプロキシするかどうかOffice 365。 これは簡単です。プロキシを使用しない。 Office 365はインターネットを使用してアクセスされますが、インターネットではありません。 これはコア サービスの拡張機能であり、そのサービスとして扱われる必要があります。 DLP やマルウェア対策、コンテンツ 検査など、プロキシに必要な操作は、サービスで既に利用できます。TLS で暗号化された接続を割り込む必要なく、大規模に使用できます。 しかし、他の方法では制御できないトラフィックを本当にプロキシする場合は、ガイダンスとトラフィックのカテゴリに [https://aka.ms/pnc](../enterprise/microsoft-365-network-connectivity-principles.md) 注意を払います [https://aka.ms/ipaddrs](../enterprise/urls-and-ip-address-ranges.md) 。 ユーザーのトラフィックには 3 つのOffice 365。 最適化と許可は、実際には直接行き、プロキシをバイパスする必要があります。 既定のプロキシを使用できます。 詳細は、これらの docs...に含されています。それらを読み取る。

プロキシの使用を主張するほとんどのお客様は、実際に自分のやっていることを確認するときに、クライアントがプロキシに HTTP CONNECT 要求を行う際に、プロキシがコストのかかる余分なルーターになっていることに気付くでしょう。 MAPI や RTC などの使用されているプロトコルは、Web プロキシが理解するプロトコルですらないので、TLS が割れた場合でも、実際にはセキュリティを強化することはできません。 余分 *な* 待機時間が発生しています。 トラフィックの最適化、許可、既定のカテゴリなど、詳細については [https://aka.ms/pnc](../enterprise/microsoft-365-network-connectivity-principles.md) 、Microsoft 365してください。

最後に、プロキシに対する全体的な影響とその対応する応答を検討して、その影響に対処します。 プロキシを介して接続が増えるにしたがって、TCP スケール ファクターが減少し、トラフィックをバッファーに入る必要が生じなくなかっている可能性があります。 プロキシが過負荷でスケール ファクター 0 を使用していたお客様を見たことがあります。 Scale Factor は指数関数的な値であり、8 を使うのが好きですが、スケール ファクター値の各削減はスループットに大きな悪影響を与えます。

TLS 検査とは、セキュリティを意味します。 しかし、実際にはそうではありません! プロキシを使用している多くのお客様は、それらを使用してすべてのトラフィックを検査したいと思っています。 HTTPS 経由でアクセスされる Web サイト (プライバシーに関する懸念にもかかわらず) に対してこれを行う場合、プロキシは数百ミリ秒の間、10 または 20 の同時ストリームでこれを行う必要があります。 大規模なダウンロードやビデオが含まれる場合は、1 つ以上の接続が長持ちする可能性がありますが、全体として、これらの接続のほとんどが非常に迅速に確立、転送、および終了します。 ブレークと検査を行うということは、プロキシが作業を 2 倍にしなければならないことを意味します。 クライアントからプロキシへの接続ごとに、プロキシはエンドポイントに別の接続を戻す必要があります。 したがって、1 は 2 になり、2 は 4 になり、32 は 64 になります。..私が行く場所を参照してください。 通常の Web サーフィンではプロキシ ソリューションのサイズを設定したと思いますが、Office 365 へのクライアント接続に対して同じことを行う場合、同時に長時間使用される接続の数は、サイズを設定したサイズよりも大きい桁の大きさになる場合があります。

### <a name="streaming-isnt-important-except-that-it-is"></a>ストリーミングは重要ではありません。ただし、ストリーミングは重要 *ではありません。*

UDP を使用するOffice 365サービスは、Skype (間もなく廃止される予定) とMicrosoft Teams。 Teamsは、オーディオ、ビデオ、プレゼンテーション共有などのストリーミング トラフィックに UDP を使用します。 ストリーミング トラフィックは、音声、ビデオ、デッキの提示、デモの実行を含むオンライン会議を行う場合など、ライブです。 これらは UDP を使用します。パケットがドロップされた場合、または順序が不一緒に到着した場合、ユーザーは実質的に気が付かないので、ストリームはただ続けることができます。

クライアントからサービスへの送信 UDP トラフィックを許可しない場合、TCP の使用に戻る可能性があります。 ただし、TCP パケットがドロップされた場合、再送信タイムアウト (RTO) の有効期限が切れ、欠落しているパケットを再送信できるまで、すべてが停止します。 パケットが順番に外れた場合、他のパケットが到着するまですべてが停止し、順番に再構成できます。 両方とも、オーディオ (Max Headroom?) とビデオ (何かをクリックした場合) で知覚可能な不具合を引き起こします。ああ、そこにある)とパフォーマンスの低下と悪いユーザー エクスペリエンスにつながります。 そして、プロキシについて上記に示したことを覚えていますか? クライアントに強制的Teamsプロキシを使用する場合は、強制的に TCP を使用します。 これで、パフォーマンスに悪影響が 2 回発生します。

### <a name="split-tunneling-may-seem-scary"></a>スプリット トンネリングは恐ろしいと思われる場合があります

しかし、そうではない。 サーバーへのすべての接続Office 365 TLS を超える。 以前から TLS 1.2 を提供しています。従来のクライアントは引き続き使用し、リスクを伴うので、古いバージョンは間もなく無効になります。

サービスにアクセスする前に TLS 接続 (32) を VPN を越える必要がある場合、セキュリティは追加しません。 待機時間が追加され、全体的なスループットが低下します。 一部の VPN ソリューションでは、UDP を TCP 経由でトンネリングする必要が生じ、ストリーミング トラフィックに非常に悪影響を及ぼす可能性があります。 また、TLS 検査を実行しない限り、上振れはありません。すべての欠点があります。 従業員のほとんどがリモートである今、顧客の間で非常に一般的なテーマは、オプティマイズ カテゴリ[Office 365](../enterprise/microsoft-365-network-connectivity-principles.md#new-office-365-endpoint-categories)エンドポイントにアクセスするためのスプリット トンネリングを構成するのではなく、すべてのユーザーが VPN を使用して接続する場合の帯域幅とパフォーマンスに大きな影響を与える点です。

スプリット トンネリングを簡単に行う修正であり、実行する必要があります。 詳細については、「VPN スプリット トンネリングを[使用Office 365ユーザーの接続の最適化」を確認してください](../enterprise/microsoft-365-vpn-split-tunnel.md)。

## <a name="the-sins-of-the-past"></a>過去の罪

多くの場合、悪い選択が行われた理由は、(1) サービスの動作を知らない、(2) クラウドを採用する前に作成された会社のポリシーに従おうとする、(3) 複数の方法で目標を達成できると簡単に確信できないセキュリティ チームの組み合わせです。 うまくいけば、上記と以下のリンクは、最初のリンクに役立ちます。 2 回目を過ぎた場合は、エグゼクティブ スポンサーシップが必要になる場合があります。 セキュリティ ポリシーの目標に対処する方法ではなく、3 つ目の方法に役立ちます。 条件付きアクセスからコンテンツ モデレート、DLP から情報保護、エンドポイントの検証、ゼロデイ脅威まで、Office 365 で使用可能な情報を使用して、オンプレミスのネットワーク ギア、強制 VPN トンネル、TLS のブレークと検査に依存することなく、妥当なセキュリティ ポリシーを達成できます。

また、組織がクラウドへの移行を開始する前にサイズを設定して購入したハードウェアは、新しいトラフィック パターンと負荷を処理するためにスケール アップできません。 すべてのトラフィックを単一の出力ポイント経由でルーティングし、プロキシする必要がある場合は、ネットワーク機器と帯域幅をアップグレードする準備が必要です。 より多くのユーザーがオンボードするほど、エクスペリエンスが徐々に低下しなかからないので、両方の使用率を注意深く監視します。 チップポイントに達するまで、すべてが問題ありません。その後、誰もが苦しんでいる。

## <a name="exceptions-to-the-rules"></a>ルールの例外

組織でテナントの制限 [が](/azure/active-directory/manage-apps/tenant-restrictions)必要な場合は、TLS ブレークを含むプロキシを使用して、プロキシを強制的にトラフィックを検査する必要がありますが、すべてのトラフィックを強制的に通過する必要はありません。  これは、すべてまたは何も命題ではないので、プロキシによって変更する必要があるものに注意してください。

スプリット トンネリングを許可する一方で、一般的な Web トラフィックにもプロキシを使用する場合は、PAC ファイルで、VPN トンネルを通過するトラフィックに関する興味深いトラフィックを定義する方法と同様に、直接行う必要がある処理を定義してください。 サンプル PAC ファイルを提供 [https://aka.ms/ipaddrs](../enterprise/urls-and-ip-address-ranges.md) しています。これにより、管理が容易になります。

## <a name="conclusion"></a>結論

ほぼすべての Fortune 500 を含む数万の組織は、ミッション クリティカルな機能Office 365毎日使用しています。 セキュリティで保護され、インターネットを使用して行います。

どのようなセキュリティ目標を達成しても、VPN 接続、プロキシ サーバー、TLS のブレークと検査、またはインターネットの一元化を必要としない方法があります。ネットワークからユーザーのトラフィックを迅速に取得し、ネットワークが会社の本社かどうかに関係なく、最高のパフォーマンスを提供します。、リモート オフィス、または自宅で作業しているユーザー。 このガイダンスは、サービスの構築方法Office 365、セキュリティで保護されたパフォーマンスの高いユーザー エクスペリエンスを確保するために基づいて行います。

## <a name="further-reading"></a>その他の読み取り

[ネットワークOffice 365原則](../enterprise/microsoft-365-network-connectivity-principles.md)

[Office 365 の URL と IP アドレスの範囲](../enterprise/urls-and-ip-address-ranges.md)

[Office 365 エンドポイントの管理](../enterprise/managing-office-365-endpoints.md)

[Office 365 IP アドレスと URL の Web サービス ](../enterprise/microsoft-365-ip-web-service.md)

[Office 365 のネットワーク接続の評価](../enterprise/assessing-network-connectivity.md)

[Office 365 のネットワークとパフォーマンスのチューニング](../enterprise/network-planning-and-performance.md)

[Office 365 ネットワーク接続の評価](../enterprise/assessing-network-connectivity.md)

[ベースラインとパフォーマンス履歴を使用した、Office 365 のパフォーマンスのチューニング](../enterprise/performance-tuning-using-baselines-and-history.md)

[Office 365 のパフォーマンスに関するトラブルシューティングの計画](../enterprise/performance-troubleshooting-plan.md)

[Content Delivery Network](../enterprise/content-delivery-networks.md)

[Microsoft 365 の接続テスト](https://connectivity.office.com/)

[Microsoft がそのファースト・信頼性の高いグローバルネットワークを構築する方法](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

[Office 365 ネットワークのしくみ](https://techcommunity.microsoft.com/t5/office-365-networking/bd-p/Office365Networking)

[Office 365 VPN スプリット トンネリングを使用したリモート ユーザーの接続の確立](../enterprise/microsoft-365-vpn-split-tunnel.md)