---
title: クラウドへのネットワーキング — あるアーキテクトの視点
description: 最も一般的な落とし穴を回避して、クラウド接続のためにネットワークを最適化する方法について説明します。
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
ms.localizationpriority: medium
ms.collection:
- M365-identity-device-management
- M365-security-compliance
ms.custom: ''
f1.keywords: NOCSH
ms.openlocfilehash: 5f90e4616edd3534baefd64bba5a2eec640f6366
ms.sourcegitcommit: 195e4734d9a6e8e72bd355ee9f8bca1f18577615
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/13/2022
ms.locfileid: "64823940"
---
# <a name="networking-up-to-the-cloudone-architects-viewpoint"></a>クラウドへのネットワーキング — あるアーキテクトの視点

この記事では、Microsoft のセキュリティ & コンプライアンス アーキテクトである [Ed Fisher](https://www.linkedin.com/in/edfisher/) が、最も一般的な落とし穴を回避することで、クラウド接続のためにネットワークを最適化する方法について説明します。

## <a name="about-the-author"></a>筆者について

![Ed Fisher の写真。](../media/solutions-architecture-center/ed-fisher-networking.jpg)

現在は、リテールおよびコンシューマー製品チームの主要な技術スペシャリストであり、セキュリティ&コンプライアンスに重点を置いて取り組んでいます。 過去 10 年間、Office 365に移行するお客様と協力してきました。 私は、政府機関や数百万人のユーザーが世界中に分散している企業や、その間に多数の顧客を抱える小規模なショップで働いてきましたが、その大半には数万人のユーザー、世界各地の複数の場所、より高度なセキュリティの必要性、多数のコンプライアンス要件があります。 私は、何百もの企業と何百万人ものユーザーが安全かつ安全にクラウドに移行するのを支援してきました。

セキュリティ、インフラストラクチャ、ネットワーク エンジニアリングを含む過去 25 年間のバックグラウンドを持ち、以前の勤務先の 2 人を Microsoft に入社する前にOffice 365に移しました。私はテーブルの側に何度もいました。また、そのようなことを思い出してください。 同じ顧客は 2 人もいませんが、ほとんどが同じニーズを持ち、SaaS や PaaS プラットフォームなどの標準化されたサービスを使用する場合、最適なアプローチは同じ傾向があります。

## <a name="its-not-the-network--its-how-youre-misusing-it"></a>ネットワークではありません。これは、(誤って) 使用している方法です。

何度発生しても、 *クリエイティブ な* セキュリティ チームやネットワーク チームが、Microsoft クラウド サービスに接続する必要があると考える方法を試みる方法を驚かせることができます。 セキュリティ ポリシー、コンプライアンス標準、またはより適切な方法が常に存在します。これは、達成しようとしているものや、より優れた、より簡単で、よりコスト効率が高く、パフォーマンスの高い方法がある *方法* について会話を行う必要はありません。

この種のことが私にエスカレートされたら、通常はチャレンジを行い、その方法と理由を説明し、必要な場所に移動します。 しかし、私が完全に率直に言っている場合は、時にはそれを共有する必要があります。そして、彼らが最終的に譲歩したときにうまくいかないと言ったと言って戻ってきます。 私は時々それを行いたいと思うかもしれませんが、 *そうはしません*。 私が行っていることは、この投稿に含めるすべてのことを説明しようとしています。 自分の役割に関係なく、組織が Microsoft クラウド サービスを使用する場合は、おそらくそれに続くいくつかの知恵が役に立つでしょう。

## <a name="guiding-principles"></a>原則を導く

ここで行っていることに関するいくつかの基本ルールから始めましょう。 クラウド サービスに安全に接続して、最小限の複雑さと最大のパフォーマンスを確保しながら、実際のセキュリティを維持する方法について説明しています。 お客様またはお客様が、すべてのお気に入りのプロキシ サーバーを使用できない場合でも、それに反するものはありません。

- できるからといって **、そうする必要はありません**。または、Jurassic Park 映画 ".. から Ian Malcolm 博士を言い換える必要があります。はい、はい、しかし、セキュリティ チームは、必要かどうかを考えるのをやめられなかったかどうかに気が付いていたのです。
- **セキュリティは複雑さを意味しません**。より多くのコストを費やしたり、より多くのデバイスを経由したり、より多くのボタンをクリックしたりするという理由だけで、セキュリティが強化されません。
- **Office 365はインターネット経由でアクセスされます**。ただし、インターネットOffice 365同じではありません。 これは、Microsoft によって管理され、お客様が管理する SaaS サービスです。 インターネット上でアクセスする Web サイトとは異なり、実際には幕の後ろを見ることができ、ポリシーとコンプライアンス基準を満たすために必要なコントロールを適用できます。目標を達成できる一方で、別の方法で行う必要がある場合があります。
- **悪い、ローカライズされたブレークアウトは良好です**。すべてのユーザーが常にすべてのインターネット トラフィックを一定の中心点に戻したいと考えています。通常は、監視してポリシーを適用できますが、多くの場合、すべての場所でインターネット アクセスをプロビジョニングするよりも安いか、その方法だけです。 しかし、これらの点はまさにそのとおりです...トラフィックが詰まるポイント。 ユーザーが Instagram を参照したり、猫のビデオをストリーミングしたりするのを防ぐことに問題はありませんが、ミッション クリティカルなビジネス アプリケーションのトラフィックを同じように扱わないでください。
- **DNS が満足できない場合は、何も満足しません**。最適に設計されたネットワークは、世界の他の地域のサーバーに対する要求を再帰するか、ISP の DNS サーバーまたは DNS 解決情報をキャッシュする他のパブリック DNS サーバーを使用するかに関係なく、低い DNS によって最適化できます。
- 以前はそうだったからといって **、今はそうする必要** はありません。テクノロジは絶えず変化し、Office 365も例外ではなくなります。 オンプレミス サービスまたは Web 閲覧を制御するために開発およびデプロイされたセキュリティ対策を適用しても、同じレベルのセキュリティ保証は提供されず、パフォーマンスに大きな悪影響を及ぼす可能性があります。
- **Office 365は、インターネット経由でアクセスできるように構築されました**。簡単に言えば、この機能です。 ユーザーとエッジの間で何をする必要がある場合でも、トラフィックはネットワークから離れた後、ネットワークに到達する前にインターネットを経由します。 Azure ExpressRoute を使用して、ネットワークから Microsoft に直接待機時間の影響を受けやすいトラフィックをルーティングする場合でも、インターネット接続が絶対に必要です。 受け入れます。 考えすぎないでください。

## <a name="where-bad-choices-are-often-made"></a>不適切な選択が頻繁に行われる場所

セキュリティの名の下に悪い決定を下す場所はたくさんありますが、これらはお客様と最も頻繁に遭遇するものです。 多くの顧客の会話には、これらすべてが一度に含まれます。

### <a name="insufficient-resources-at-the-edge"></a>エッジのリソースが不足している

グリーンフィールド環境を展開しているお客様は非常に少なく、ユーザーの作業方法とインターネットエグレスに関する長年の経験があります。 顧客がプロキシ サーバーを持っているか、直接アクセスを許可し、NAT 送信トラフィックを許可するかにかかわらず、長年にわたってそれを行っており、従来の内部アプリケーションをクラウドに移行する際に、エッジを通じてポンプを開始する量をどれだけ増やすかは考慮しません。

帯域幅は常に懸念事項ですが、NAT デバイスは負荷の増加を処理するのに十分な能力を持っていない可能性があり、リソースを解放するために途中で接続を閉じ始める可能性があります。 Office 365に接続するクライアント ソフトウェアのほとんどは永続的な接続を必要とし、Office 365を完全に利用しているユーザーは 32 以上の同時接続を持つ可能性があります。 NAT デバイスが途中でドロップしている場合、それらのアプリは、もう存在しない接続を使用しようとすると応答しなくなる可能性があります。 彼らが放棄して新しい接続を確立しようとすると、ネットワーク ギアにさらに負荷がかけられます。

### <a name="localized-breakout"></a>ローカライズされたブレークアウト

この一覧の他のすべては、ネットワークから離れ、できるだけ早く Microsoft にアクセスするという 1 つのことに分類されます。 ユーザーのトラフィックを中央のエグレス ポイントにバックホールします。特に、そのエグレス ポイントがユーザーがいるリージョン以外のリージョンにある場合は、不要な待機時間が発生し、クライアント エクスペリエンスとダウンロード速度の両方に影響します。 Microsoft には、ほぼすべての主要な ISP で確立されたすべてのサービスとピアリングのフロントエンドを備えた世界中のプレゼンス ポイントがあるため、ユーザーのトラフィックを *ローカルに* ルーティングすることで、待機時間を最小限に抑えてネットワークに迅速にアクセスできます。

### <a name="dns-resolution-traffic-should-follow-the-internet-egress-path"></a>DNS 解決トラフィックは、インターネットエグレス パスに従う必要があります

もちろん、クライアントが任意のエンドポイントを検索するには、DNS を使用する必要があります。 Microsoft の DNS サーバーは、DNS 要求のソースを評価して、要求のソースに最も近いインターネット用語で応答を返すようにします。 名前解決要求がユーザーのトラフィックと同じパスを出るように DNS が構成されていることを確認します。ただし、ローカルエグレスを提供するのではなく、別のリージョンのエンドポイントに送信してください。 つまり、リモート データ センター内の DNS サーバーに転送するのではなく、ローカル DNS サーバーを "ルートに移動" することを意味します。 また、パブリック DNS サービスとプライベート DNS サービスに注意してください。これは、世界の一部からの結果をキャッシュし、それらを世界の他の部分からの要求に提供する可能性があります。

### <a name="to-proxy-or-not-to-proxy-that-is-the-question"></a>プロキシをプロキシする場合とプロキシしない場合は、それが問題です。

最初に考慮すべき点の 1 つは、ユーザーのOffice 365への接続をプロキシするかどうかです。 これは簡単です。プロキシを行いません。 Office 365はインターネット経由でアクセスされますが、インターネットではありません。 これはコア サービスの拡張機能であり、そのように扱う必要があります。 DLP やマルウェア対策、コンテンツ検査など、プロキシに必要な操作はサービスで既に利用でき、TLS で暗号化された接続を解読することなく、大規模に使用できます。 ただし、それ以外の方法では [https://aka.ms/pnc](../enterprise/microsoft-365-network-connectivity-principles.md) 制御できないトラフィックをプロキシする場合は、Microsoft のガイダンスとトラフィック [https://aka.ms/ipaddrs](../enterprise/urls-and-ip-address-ranges.md)のカテゴリに注意してください。 Office 365のトラフィックには 3 つのカテゴリがあります。 最適化と許可は実際に直接行き、プロキシをバイパスする必要があります。 既定値はプロキシできます。 詳細はこれらのドキュメントに含まれています。..読み取りを行います。

プロキシの使用を主張するほとんどのお客様は、実際に自分の動作を確認するときに、クライアントがプロキシに対して HTTP CONNECT 要求を行うときに、プロキシが高価な余分なルーターであることを認識するようになりました。 MAPI や RTC などの使用中のプロトコルは、Web プロキシが理解するプロトコルでもありません。そのため、TLS の割れがあっても、実際には追加のセキュリティは得られません。 余分な待機時間 *が* 発生しています。 詳細については、Microsoft 365 トラフィックの最適化、許可、既定のカテゴリなどをご覧[https://aka.ms/pnc](../enterprise/microsoft-365-network-connectivity-principles.md)ください。

最後に、プロキシへの全体的な影響とそれに対応する応答を考慮して、その影響に対処します。 プロキシを介して接続する接続が増えるにつれて、TCP スケール ファクターが減少し、それほど多くのトラフィックをバッファリングする必要がなくなります。 プロキシが過負荷になり、Scale Factor 0 を使用していたお客様を見てきました。 Scale Factor は指数値であり、8 を使用するのが好きなので、Scale Factor 値の各減少はスループットに大きな悪影響を及ぼします。

TLS 検査はセキュリティを意味します。 しかし、実際にはありません。 プロキシを使用している多くのお客様は、それらを使用してすべてのトラフィックを検査することを望んでいます。つまり、TLS の "中断と検査" を意味します。 HTTPS 経由でアクセスされた Web サイト (プライバシーに関する懸念事項) に対してこれを行う場合、プロキシは数百ミリ秒の間、10 または 20 個の同時ストリームに対してこれを行う必要がある場合があります。 大量のダウンロードやビデオが関係している場合、それらの接続の 1 つ以上の接続は長持ちする可能性がありますが、全体的に見て、それらの接続のほとんどは、非常に迅速に確立、転送、および閉じられます。 中断と検査を実行すると、プロキシは作業を 2 倍にする必要があります。 クライアントからプロキシへの接続ごとに、プロキシはエンドポイントに個別に接続する必要もあります。 したがって、1 は 2 になり、2 は 4 になり、32 は 64 になります。..どこに行くのか確認してください。 通常の Web 閲覧ではプロキシ ソリューションのサイズは問題ありませんが、Office 365へのクライアント接続で同じことを行おうとすると、同時に有効期間が長い接続の数がサイズ設定した数より大きい場合があります。

### <a name="streaming-isnt-important-except-that-it-is"></a>ストリーミングは重要ではありませんが、

UDP を使用するOffice 365内の唯一のサービスはSkype (まもなく廃止される予定) であり、Microsoft Teams。 Teamsでは、オーディオ、ビデオ、プレゼンテーション共有などのトラフィックをストリーミングするために UDP を使用します。 ストリーミング トラフィックはライブです。たとえば、音声、ビデオ、デッキのプレゼンテーション、デモを行うオンライン会議を行っている場合などです。 これらは UDP を使用します。これは、パケットがドロップされたり、順不同に到着したりすると、実質的にユーザーが認識できず、ストリームが継続し続けることができるためです。

クライアントからサービスへの送信 UDP トラフィックを許可しない場合、TCP の使用にフォールバックできます。 ただし、TCP パケットがドロップされると、再送信タイムアウト (RTO) の有効期限が切れ、不足しているパケットを再送信できるまで *すべてが停止* します。 パケットが順不同に到着すると、他のパケットが到着するまですべてが停止し、順番に再構成できます。 どちらも、オーディオ (最大ヘッドルームを覚えていますか?) とビデオ (何かをクリックしましたか..oh, ある) と、パフォーマンスの低下とユーザー エクスペリエンスの低下につながります。 プロキシに関して上に置いた内容を覚えていますか? Teams クライアントに強制的にプロキシを使用させる場合は、強制的に TCP を使用します。 そのため、パフォーマンスへの悪影響が 2 回発生しています。

### <a name="split-tunneling-may-seem-scary"></a>分割トンネリングが恐ろしいように見える可能性がある

しかし、そうではありません。 Office 365への接続はすべて TLS 経由です。 以前から TLS 1.2 を提供してきましたが、レガシ クライアントでは引き続き使用されるため、古いバージョンはまもなく無効になります。これはリスクです。

TLS 接続 (そのうちの 32) を強制的に VPN 経由にしてからサービスに移動しても、セキュリティは追加されません。 待機時間が増え、全体的なスループットが低下します。 一部の VPN ソリューションでは、UDP に TCP 経由のトンネリングを強制することさえあります。これは再びストリーミング トラフィックに非常に悪影響を及ぼします。 また、TLS 検査を行っている場合を除き、上向き、すべての欠点はありません。 ほとんどの従業員がリモートであるお客様の間で非常に一般的なテーマは、[オプティマイズ カテゴリOffice 365エンドポイント](../enterprise/microsoft-365-network-connectivity-principles.md#new-office-365-endpoint-categories)へのアクセス用に分割トンネリングを構成するのではなく、すべてのユーザーが VPN を使用して接続することによる帯域幅とパフォーマンスへの大きな影響が見られるということです。

分割トンネリングを行うのが簡単な修正であり、実行する必要があります。 詳細については、「[VPN 分割トンネリングを使用してリモート ユーザーの接続Office 365最適化する](../enterprise/microsoft-365-vpn-split-tunnel.md)」を参照してください。

## <a name="the-sins-of-the-past"></a>過去の罪

多くの場合、不適切な選択が行われる理由は、(1) サービスのしくみを知らない、(2) クラウドを採用する前に記述された会社のポリシーに準拠しようとしている、(3) 目標を達成する方法が複数あると簡単に確信できないセキュリティ チームの組み合わせにあります。 上記と以下のリンクが最初に役立つと思います。 2 回目を過ぎると、エグゼクティブ スポンサーシップが必要になる場合があります。 セキュリティ ポリシーの目標に対処することは、その方法ではなく、3 番目の方法に役立ちます。 条件付きアクセスからコンテンツ モデレーション、DLP から情報保護、エンドポイント検証、ゼロデイ脅威まで、Office 365で使用可能なもので、オンプレミスのネットワーク ギア、強制 VPN トンネル、TLS の中断と検査に依存することなく、妥当なセキュリティ ポリシーを実現できます。

また、組織がクラウドへの移行を開始する前にサイズ変更および購入されたハードウェアは、単に新しいトラフィック パターンと負荷を処理するためにスケールアップすることはできません。 すべてのトラフィックを単一のエグレス ポイント経由でルーティングする必要がある場合や、それをプロキシする必要がある場合は、それに応じてネットワーク機器と帯域幅をアップグレードする準備をしてください。 より多くのユーザーがオンボードするにつれてエクスペリエンスが低下しないため、両方の使用率を慎重に監視します。 チップ ポイントに達するまですべてが問題なく、全員が苦しみます。

## <a name="exceptions-to-the-rules"></a>ルールの例外

組織で [テナントの制限](/azure/active-directory/manage-apps/tenant-restrictions)が必要な場合は、TLS ブレークを含むプロキシを使用し、プロキシを介して一部のトラフィックを強制的に検査する必要がありますが、すべてのトラフィックを強制的に通過させる必要はありません。  これはすべてまたは何の提案でもありません。そのため、プロキシによって変更する必要がある内容に注意してください。

分割トンネリングを許可する一方で、一般的な Web トラフィック用のプロキシも使用する場合は、PAC ファイルで直接実行する必要がある内容と、VPN トンネルを通過する対象の興味深いトラフィックを定義する方法が定義されていることを確認します。 サンプル PAC ファイル [https://aka.ms/ipaddrs](../enterprise/urls-and-ip-address-ranges.md) を提供することで、これを簡単に管理できます。

## <a name="conclusion"></a>終わりに

ほとんどのフォーチュン 500 を含む何万もの組織が、ミッション クリティカルな機能のために毎日Office 365を使用しています。 セキュリティで保護され、インターネット経由で行われます。

どのようなセキュリティ目標を果たしていても、VPN 接続、プロキシ サーバー、TLS の中断と検査、または一元化されたインターネット エグレスを必要としない方法があります。これにより、ネットワークが会社の本社であるかどうかに関係なく、ユーザーのトラフィックをできるだけ早くネットワークから離れ、可能な限り迅速に行うことができます。 リモート オフィス、または自宅で作業しているユーザー。 このガイダンスは、Office 365 サービスの構築方法と、セキュリティで保護されたパフォーマンスの高いユーザー エクスペリエンスの確保に基づいています。

## <a name="further-reading"></a>その他の読み取り

[Office 365 ネットワーク接続の原則](../enterprise/microsoft-365-network-connectivity-principles.md)

[Office 365 の URL と IP アドレスの範囲](../enterprise/urls-and-ip-address-ranges.md)

[Office 365 エンドポイントの管理](../enterprise/managing-office-365-endpoints.md)

[Office 365 IP アドレスと URL の Web サービス ](../enterprise/microsoft-365-ip-web-service.md)

[Office 365 のネットワーク接続の評価](../enterprise/assessing-network-connectivity.md)

[Office 365 のネットワークとパフォーマンスのチューニング](../enterprise/network-planning-and-performance.md)

[Office 365 ネットワーク接続の評価](../enterprise/assessing-network-connectivity.md)

[ベースラインとパフォーマンス履歴を使用した、Office 365 のパフォーマンスのチューニング](../enterprise/performance-tuning-using-baselines-and-history.md)

[Office 365 のパフォーマンスに関するトラブルシューティングの計画](../enterprise/performance-troubleshooting-plan.md)

[Content Delivery Network](../enterprise/content-delivery-networks.md)

[Microsoft 365 の接続テスト](https://connectivity.office.com/)

[Microsoft がそのファースト・信頼性の高いグローバルネットワークを構築する方法](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

[Office 365 ネットワークのしくみ](https://techcommunity.microsoft.com/t5/office-365-networking/bd-p/Office365Networking)

[VPN 分割トンネリングを使用したリモート ユーザーのOffice 365接続](../enterprise/microsoft-365-vpn-split-tunnel.md)
