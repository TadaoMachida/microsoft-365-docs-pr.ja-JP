---
title: Microsoft 365 の検索でのテナントの分離
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: この記事では、Microsoft 365 Search でテナントデータを分離するためにテナント分離がどのように機能するかについて説明します。
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 3416afdeceaa7000b516ec89b4a2a1e59d8708d0
ms.sourcegitcommit: 27addd4dac07926528b788215d2dcd0e46301eb1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/16/2021
ms.locfileid: "53464086"
---
# <a name="tenant-isolation-in-microsoft-365-search"></a>Microsoft 365 の検索でのテナントの分離

SharePoint オンライン検索では、テナント間の情報漏えいに対する保護と共有データ構造の効率のバランスを取るテナント分離モデルが使用されます。 このモデルでは、検索機能で次のことを防ぎます。

- 他のテナントからのドキュメントを含むクエリ結果を返す
- スキルのあるユーザーが他のテナントに関する情報を推論できるクエリ結果に十分な情報を公開する
- 別のテナントからのスキーマまたは設定の表示
- テナント間で分析処理情報を混在させるか、間違ったテナントに結果を格納する
- 別のテナントからのディクショナリ エントリの使用

テナント データの種類ごとに、コード内の 1 つ以上の保護レイヤーを使用して、情報の偶発的な漏洩を防ぎます。 最も重要なデータには、単一の欠陥によって実際の情報漏えいや認識された情報漏えいが発生しないようにするための保護レイヤーが最も多く含まれています。

## <a name="tenant-separation-for-the-search-index"></a>検索インデックスのテナント分離

検索インデックスは、インデックス コンポーネントをホストするサーバー内のディスクに格納され、テナントはインデックス ファイルを共有します。 テナントのインデックス付きドキュメントは、そのテナントのクエリに対してのみ表示されます。 3 つの独立したメカニズムにより、情報漏えいが防止されます。

- テナント ID のフィルター処理
- テナント ID 用語プレフィックス
- ACL チェック

ドキュメントを間違ったテナントに返すには、3 つのメカニズムがすべて失敗する必要があります。

## <a name="tenant-id-filtering-and-tenant-id-term-prefixing"></a>テナント ID フィルター処理とテナント ID 用語プレフィックス

検索プレフィックスは、テナント ID を使用してフルテキスト インデックスにインデックスが付けられるすべての用語をプレフィックスとして使用します。 たとえば、ID が "*123*" のテナントに対して "*foo*" という用語がインデックス付けされている場合、フルテキスト インデックスのエントリは "*123foo*" です。

すべてのクエリは、テナント ID フィルター処理と呼ばれるプロセスを使用してテナント ID を含めるために変換されます。 たとえば、クエリ "*foo*" は "<*guid*>に変換されます。*Foo* AND *tenantID*:<*guid*>"。ここで、<*guid*>は、クエリを実行しているテナントを表します。 このクエリ変換は各インデックス ノード内で行われ、クエリもコンテンツ処理も影響しません。 テナント ID はすべてのクエリに追加されるため、他のテナントの用語の頻度は、1 つのテナントで最も一致するランク付けを調べて推論することはできません。

テナント ID 用語のプレフィックスは、フルテキスト インデックスでのみ発生します。 "*title:foo*" などのフィールド検索は、用語にテナント ID のプレフィックスが付いていない合成検索インデックスに移動します。 代わりに、フィールド検索の先頭にフィールド名が付けられます。 たとえば、クエリ "*title:foo*" は "*fields.title:foo AND fields.tenantID:*<*guid*>" に変換されます。 用語の頻度は合成検索インデックスのヒットのランク付けに影響しないため、用語プレフィックスによるテナントの分離は必要ありません。 "*title:foo*" などのフィールド検索の場合、テナント コンテンツの分離は、クエリ変換によるテナント ID フィルター処理に依存します。

## <a name="document-access-control-list-checks"></a>ドキュメント Access Control リスト チェック

検索は、検索インデックスに保存されている ACL を介してドキュメントへのアクセスを制御します。 すべての項目は、特別な ACL フィールド内の用語のセットを使用してインデックスが作成されます。 ACL フィールドには、ドキュメントを表示できるグループまたはユーザーごとに 1 つの用語が含まれています。 すべてのクエリは、認証されたユーザーが属するグループごとに 1 つずつ、アクセス制御エントリ (ACE) 用語の一覧で拡張されます。

たとえば、"<*guid*>" のようなクエリです。*foo AND tenantID*:<*guid*>" は"<*guid*>。*foo AND tenantID*:<*guidAND* >  (*docACL:*<*ace1OR*>  *docACL*:<*ace2OR*>  *docACL*:<*ace3*> *....*)"

ユーザー識別子とグループ識別子、つまり ACE は一意であるため、一部のユーザーだけが表示できるドキュメントのテナント間のセキュリティが強化されます。 テナント内の通常のユーザーへのアクセスを許可する特殊な "外部ユーザーを除くすべてのユーザー" ACE の場合も同じです。 ただし、"Everyone" の ACE はすべてのテナントで同じであるため、パブリック ドキュメントのテナント分離はテナント ID のフィルター処理に依存します。 拒否 ACE もサポートされています。 クエリ拡張では、拒否 ACE との一致がある場合に結果からドキュメントを削除する句が追加されます。

Exchange Online検索では、インデックスは、SharePoint Online のように、テナント ID (サブスクリプション ID) ではなく、個々のユーザーのメールボックスのメールボックス ID でパーティション分割されます。 パーティション分割メカニズムは、SharePoint Online と同じですが、ACL フィルター処理はありません。
