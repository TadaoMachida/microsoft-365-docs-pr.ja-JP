---
title: エクスプロイト保護をカスタマイズする
keywords: エクスプロイトの保護、軽減、有効化、powershell、dep、cfg、emet、aslr
description: アプリまたは PowerShell を使用して、エクスプロイト保護で使用される特定の軽減策Windows セキュリティ無効にできます。 また、軽減策を監査し、構成をエクスポートできます。
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
audience: ITPro
ms.topic: conceptual
author: dansimp
ms.author: dansimp
ms.reviewer: ''
manager: dansimp
ms.technology: mde
ms.openlocfilehash: f387731c491800cf5bd717322986b4301a7729ba
ms.sourcegitcommit: 6c342a956b2dbc32be33bac1a23a5038490f1b40
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/26/2021
ms.locfileid: "58533485"
---
# <a name="customize-exploit-protection"></a>エクスプロイト保護をカスタマイズする

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**適用対象:**
- [Microsoft Defender for Endpoint](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

> Defender for Endpoint を試す場合は、 [無料試用版にサインアップしてください。](https://signup.microsoft.com/create-account/signup?products=7f379fee-c4f9-4278-b0a1-e4c8c2fcdf7e&ru=https://aka.ms/MDEp2OpenTrial?ocid=docs-wdatp-assignaccess-abovefoldlink)

エクスプロイト保護は、オペレーティング システム プロセスと個々のアプリの両方に、多数の悪用軽減手法を自動的に適用します。

これらの設定は、個々のデバイスWindows セキュリティアプリを使用して構成します。 次に、構成を XML ファイルとしてエクスポートして、他のデバイスに展開できます。 グループ ポリシーを使用して、XML ファイルを複数のデバイスに一度に配布します。 PowerShell を使用して軽減策を構成できます。

この記事では、エクスプロイト保護で利用できる各軽減策の一覧を示します。 システム全体または個々のアプリに軽減策を適用できるかどうかを示し、軽減の仕組みについて簡単に説明します。

また、Windows セキュリティ、PowerShell、およびモバイル デバイス管理 (MDM) 構成サービス プロバイダー (CSP) を使用して軽減策を有効または構成する方法について説明します。 これは、ネットワーク全体に展開できる構成を作成する最初の手順です。 次の手順では、構成を生成、エクスポート、インポート、および複数のデバイス [に展開します](import-export-exploit-protection-emet-xml.md)。

> [!WARNING]
> 一部のセキュリティ対策テクノロジでは、一部のアプリケーションとの互換性の問題がある場合があります。 運用環境またはネットワーク全体に構成を展開する前に、[監査モード](evaluate-exploit-protection.md)を使用して、対象となるすべての使用シナリオで Exploit Protection をテストする必要があります。

## <a name="exploit-protection-mitigations"></a>エクスプロイト保護の軽減策

すべての軽減策は、個々のアプリに対して構成できます。 一部の軽減策は、オペレーティング システム レベルでも適用できます。

各軽減策は、オン、オフ、または既定値に設定できます。 一部の軽減策には、表の説明に示されている追加のオプションがあります。

既定値は、軽減策ごとに既定のオプションを使用 **するで、** 常にかっこで指定されます。 次の例では、データ実行防止の既定値は "On" です。

[ **各軽減設定** に既定の構成を使用する] は、ホーム ユーザーの日常的な使用に対する基本レベルの保護に関する推奨事項を示します。 Enterprise展開では、個々のニーズに必要な保護を考慮する必要があります。既定から構成を変更する必要がある場合があります。

軽減策ごとに関連付けられた PowerShell コマンドレットについては、この記事の下部にある [PowerShell](#cmdlets-table) リファレンス テーブルを参照してください。

|軽減策|説明|に適用できます|使用可能な監査モード|
|---|---|---|---|
|制御フロー ガード (CFG)|間接呼び出しの制御フローの整合性を確保します。 必要に応じて、エクスポートを抑制し、厳密な CFG を使用できます。|システムとアプリ レベル|いいえ|
|データ実行防止 (DEP)|ヒープやスタックなどのデータ専用メモリ ページからコードが実行されるのを防ぐ。 32 ビット (x86) アプリでのみ構成可能で、他のすべてのアーキテクチャで完全に有効になります。 必要に応じて ATL サンク エミュレーションを有効にできます。|システムとアプリ レベル|いいえ|
|イメージのランダム化の強制 (必須 ASLR)|/DYNAMICBASE でコンパイルされていないイメージを強制的に再配置します。 必要に応じて、再配置情報を持つ画像の読み込みが失敗する可能性があります。|システムとアプリ レベル|いいえ|
|メモリ割り当てのランダム化 (ボトムアップ ASLR)|仮想メモリ割り当ての場所をランダム化します。 これには、システム構造ヒープ、スタック、TEB、PEB が含まれます。 必要に応じて、64 ビット プロセスに対してより広いランダム化分散を使用できます。|システムとアプリ レベル|いいえ|
|例外チェーンの検証 (SEHOP)|例外ディスパッチ中に例外チェーンの整合性を確保します。 32 ビット (x86) アプリケーションでのみ構成可能です。|システムとアプリ レベル|いいえ|
|ヒープの整合性の検証|ヒープ破損が検出されると、プロセスを終了します。|システムとアプリ レベル|いいえ|
|任意のコード ガード (ACG)|イメージに裏付けされていない実行可能コードの導入を防止し、コード ページが変更されるのを防ぐ。 必要に応じて、スレッドのオプトアウトを許可し、リモートダウングレードを許可できます (PowerShell でのみ構成可能)。|アプリ レベルのみ|はい|
|整合性が低いイメージのブロック|低整合性でマークされたイメージの読み込みを防止します。|アプリ レベルのみ|はい|
|リモート イメージのブロック|リモート デバイスからのイメージの読み込みを防止します。|アプリ レベルのみ|いいえ|
|信頼されていないフォントのブロック|システム フォント ディレクトリにインストールされていない GDI ベースのフォント (特に Web からのフォント) の読み込みを防止します。|アプリ レベルのみ|はい|
|コードの整合性ガード|Microsoft、WHQL、または上位によって署名されたイメージの読み込みを制限します。 必要に応じて、署名Microsoft Storeを許可できます。|アプリ レベルのみ|はい|
|拡張ポイントの無効化|AppInit DLL、ウィンドウ フック、Winsock サービス プロバイダーなど、すべてのプロセスに DLL を挿入できるさまざまな機能拡張メカニズムを無効にします。|アプリ レベルのみ|いいえ|
|Win32k システム コールの無効化|アプリが Win32k システム呼び出しテーブルを使用しなくします。|アプリ レベルのみ|はい|
|子プロセスを許可しない|アプリによる子プロセスの作成を防止します。|アプリ レベルのみ|はい|
|エクスポート アドレス フィルター (EAF)|悪意のあるコードによって解決される危険な操作を検出します。 オプションで、エクスプロイトで一般的に使用されるモジュールによるアクセスを検証できます。|アプリ レベルのみ|はい|
|インポート アドレス フィルター (IAF)|悪意のあるコードによって解決される危険な操作を検出します。|アプリ レベルのみ|はい|
|実行のシミュレート (SimExec)|機密性の高い API への呼び出しが正当な呼び出し元に戻ります。 32 ビット (x86) アプリケーションでのみ構成可能です。 ACG と互換性がありません。|アプリ レベルのみ|はい|
|API 呼び出しの検証 (CallerCheck)|機密性の高い API が正当な呼び出し元によって呼び出されるのを確認します。 32 ビット (x86) アプリケーションでのみ構成可能です。 ACG と互換性がありません|アプリ レベルのみ|はい|
|ハンドルの使用状態の検証|無効なハンドル参照に対して例外が発生します。|アプリ レベルのみ|いいえ|
|軽減策の依存関係の整合性の検証|イメージの依存関係の読み込みWindowsコード署名を適用します。|アプリ レベルのみ|いいえ|
|スタックの整合性の検証 (StackPivot)|機密性の高い API に対してスタックがリダイレクトされていないか確認します。 ACG と互換性がありません。|アプリ レベルのみ|はい|

> [!IMPORTANT]
> [プログラムの設定] セクションにアプリを追加し、そこで個別の軽減設定を構成する場合は、[システム設定] セクションで指定したのと同じ軽減策の構成の上に **適用されます。** 次のマトリックスと例は、既定値の動作を説明するのに役立ちます。
>
>
> |[プログラムの **設定] で有効**|システム設定 **で有効**|動作|
> |---|---|---|
> |はい|いいえ|[プログラムの設定 **] で定義されている**|
> |はい|はい|[プログラムの設定 **] で定義されている**|
> |いいえ|はい|[システム設定] **で定義されている**|
> |いいえ|はい|[既定のオプションを使用 **する] で定義されている既定値**|
>
>
> - **例 1**
>
>    ミカエルは、[**システム設定] セクションのデータ実行防止 (DEP)** を既定で **[オフ] に構成します**。 
>
>    その後、ミカエルは[プログラム *test.exe]* セクションに **アプリの設定を追加** します。 そのアプリのオプションの [データ実行防止 **(DEP)]** で、[システム設定の上書き] オプションを有効にし、スイッチを [オン] に **設定します**。 [プログラムの設定] セクションに他の **アプリは表示** されません。
>
>    結果は、DEP が有効になるのは、次の *test.exe。* 他のすべてのアプリには DEP が適用されません。
>
>
> - **例 2**
>
>    Josie は、[システム設定] セクションのデータ実行防止 **(DEP)** を既定で **[オフ] に構成します**。
>
>    次に、Josie は[ *プログラム* test.exe設定] セクションにアプリ **の設定を追加** します。 そのアプリのオプションの [データ実行防止 **(DEP)]** で、[システム設定の上書き] オプションを有効にし、スイッチを [オン] に **設定します**。
>
>    Josie は、アプリmiles.exeを [プログラムの設定] セクションに追加し、コントロール フロー ガード **(CFG)** を On に構成 **します**。 DEP の [システム設定の **上書** き] オプションや、そのアプリのその他の軽減策を有効にしない。
>
>    その結果、DEP が有効に設定 *test.exe。* DEP は、他のアプリ (このアプリを含む)*に対miles.exe。* CFG は、ユーザーに対 *してmiles.exe。*

> [!NOTE]
> この記事で問題が見つかった場合は、Windows Server/Windows クライアント パートナーに直接報告するか、お客様の国の Microsoft テクニカル サポート番号を使用できます。

### <a name="configure-system-level-mitigations-with-the-windows-security-app"></a>アプリでシステム レベルの軽減策をWindows セキュリティする

1. タスク バーでWindows セキュリティアイコンを選択するか、Defender のスタート メニューを検索して、アプリを開 **きます**。

2. [App **& コントロール** ] タイル (または左側のメニュー バーのアプリ アイコン) を選択し、[エクスプロイト保護] **を選択します**。

3. [システム **設定] セクション** で、構成する軽減策を見つけて、次のいずれかを選択します。 [プログラムの設定] セクションで個別に構成されていないアプリは、ここで構成された設定を使用します。
   - **[既定でオン**] -この軽減策がアプリ固有の [プログラムの設定] セクションで設定されているアプリに対して **軽減策が有効** になっています。
   - **既定ではオフ**- この軽減策がアプリ固有の [プログラムの設定] セクションで設定されているアプリでは、軽減策 **は無効** になっています。
   - **既定を** 使用する - この軽減策は有効または無効になります。既定の構成によって既定の構成が既定のインストールWindows 10します。既定値 (**On** または **Off**) は、軽減策ごとに既定のラベルを使用するの **横に常** に指定されます。

   > [!NOTE]
   > 一部の設定を変更すると、[ユーザー アカウント制御] ウィンドウが表示される場合があります。 管理者資格情報を入力して設定を適用します。

   一部の設定を変更するには、再起動が必要な場合があります。

4. 構成するシステム レベルの軽減策すべてについて、この手順を繰り返します。

5. [プログラムの設定 **] セクションに** 移動し、軽減策を適用するアプリを選択します。

   1. 構成するアプリが既に一覧表示されている場合は、そのアプリを選択し、[編集] を選択 **します。**
   2. アプリが一覧に表示されていない場合は、リストの上部にある [プログラムの追加] を選択 **して** カスタマイズし、アプリの追加方法を選択します。
      - [ **プログラム名で追加] を** 使用して、その名前を持つ実行中のプロセスに軽減策を適用します。 拡張子を持つファイルを指定する必要があります。 完全なパスを入力すると、その場所に名前が付くアプリにのみ軽減策を制限できます。
      - [**厳密なファイル パスの** 選択] を使用して、標準Windowsエクスプローラー ファイルピッカー ウィンドウを使用して、必要なファイルを検索して選択します。

6. アプリを選択すると、適用できるすべての軽減策の一覧が表示されます。 軽減策を有効にするには、チェック ボックスをオンにしてスライダーを [オン] に **変更します**。 その他のオプションを選択します。 [監査] **を選択** すると、監査モードでのみ軽減策が適用されます。 プロセスまたはアプリを再起動する必要がある場合、またはアプリを再起動する必要がある場合は、通知Windows。

7. 構成するアプリと軽減策について、これらの手順を繰り返します。 構成 **の設定** が完了したら、[適用] を選択します。

これで、これらの [設定を XML ファイルとしてエクスポートするか、](import-export-exploit-protection-emet-xml.md) アプリ固有の軽減策の構成を続行できます。

構成を XML ファイルとしてエクスポートすると、構成を 1 つのデバイスから他のデバイスにコピーできます。

## <a name="powershell-reference"></a>PowerShell リファレンス

このアプリを使用Windows セキュリティエクスプロイト保護を構成するか、PowerShell コマンドレットを使用できます。

最近変更された構成設定は、PowerShell または PowerShell を使用するかどうかに関係なく、常に適用Windows セキュリティ。 つまり、アプリを使用して軽減策を構成する場合は、PowerShell を使用して同じ軽減策を構成すると、アプリが更新され、PowerShell で行った変更が表示されます。 その後、アプリを使用して軽減策を再び変更する場合は、その変更が適用されます。

> [!IMPORTANT]
> グループ ポリシーを使用してデバイスに展開された変更は、ローカル構成を上書きします。 初期構成を設定する場合は、グループ ポリシー構成を適用しないデバイスを使用して、変更が上書きされていないことを確認します。

PowerShell 動詞またはコマンドレット `Get` `Set` を使用できます `ProcessMitigation` 。 Using は、デバイスで有効になっている軽減策の現在の構成状態を一覧表示します。コマンドレットとアプリの exe を追加して、そのアプリの軽減策 `Get` `-Name` を確認します。

```PowerShell
Get-ProcessMitigation -Name processName.exe
```

> [!IMPORTANT]
> 構成されていないシステム レベルの軽減策では、の状態が表示されます `NOTSET` 。
>
> システム レベルの設定では `NOTSET` 、その軽減策の既定の設定が適用されているを示します。
>
> アプリ レベルの設定では、 `NOTSET` 軽減策のシステム レベルの設定が適用されます。
>
> 各システム レベルの軽減策の既定の設定は、次のWindows セキュリティ。

各 `Set` 軽減策を次の形式で構成する場合に使用します。

```PowerShell
Set-ProcessMitigation -<scope> <app executable> -<action> <mitigation or options>,<mitigation or options>,<mitigation or options>
```

ここで、

- \<Scope\>:
  - `-Name` を使用して、軽減策を特定のアプリに適用する必要があります。 このフラグの後にアプリの実行可能ファイルを指定します。
  - `-System` 軽減策をシステム レベルで適用する必要があります。
- \<Action\>:
  - `-Enable` を使用して軽減策を有効にする
  - `-Disable` 軽減策を無効にするには
- \<Mitigation\>:
  - 下の軽減コマンドレットの表で定義されている[](#cmdlets-table)軽減のコマンドレットと、サブオプション (スペースで囲まれた) を指定します。 各軽減策はコンマで区切られます。

たとえば、ATL サンク エミュレーションを使用してデータ実行防止 (DEP) 軽減策を有効にし、フォルダー *C:\Apps\LOB\tests* の *testing.exe* という実行可能ファイルに対して有効にし、その実行可能ファイルが子プロセスを作成しなからせた場合は、次のコマンドを使用します。

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable DEP, EmulateAtlThunks, DisallowChildProcessCreation
```

> [!IMPORTANT]
> 各軽減オプションをコンマで区切ります。

システム レベルで DEP を適用する場合は、次のコマンドを使用します。

```PowerShell
Set-Processmitigation -System -Enable DEP
```

軽減策を無効にするには、 に置き換 `-Enable` える `-Disable` 必要があります。 ただし、アプリ レベルの軽減策では、そのアプリに対してだけ軽減策を強制的に無効にします。

軽減策をシステムの既定に戻す必要がある場合は、次の例に示すコマンドレットも含 `-Remove` める必要があります。

```PowerShell
Set-Processmitigation -Name test.exe -Remove -Disable DEP
```

一部の軽減策を監査モードに設定することもできます。 軽減策に PowerShell コマンドレットを使用する代わりに、以下の軽減コマンドレットの表で指定されている監査モード[コマンドレットを使用](#cmdlets-table)します。

たとえば、以前使用したアプリケーションの監査モードで任意の Code Guard (ACG) を有効にするには、次 *testing.exe* コマンドを使用します。

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable AuditDynamicCode
```

監査モードを無効にするには、同じコマンドを使用しますが、に置き換 `-Enable` えます `-Disable` 。

### <a name="powershell-reference-table"></a>PowerShell リファレンス テーブル

次の表に、各軽減策を構成するために使用できる PowerShell コマンドレット (および関連する監査モード コマンドレット) の一覧を示します。

<a id="cmdlets-table"></a>

|軽減策|適用対象|PowerShell コマンドレット|監査モードのコマンドレット|
|---|---|---|---|
|制御フロー ガード (CFG)|システムとアプリ レベル|CFG、StrictCFG、SuppressExports|監査が利用できない|
|データ実行防止 (DEP)|システムとアプリ レベル|DEP、EmulateAtlThunks|監査が利用できない|
|イメージのランダム化の強制 (必須 ASLR)|システムとアプリ レベル|ForceRelocateImages|監査が利用できない|
|メモリ割り当てのランダム化 (ボトムアップ ASLR)|システムとアプリ レベル|BottomUp、HighEntropy|監査が利用できない|
|例外チェーンの検証 (SEHOP)|システムとアプリ レベル|SEHOP、SEHOPTelemetry|監査が利用できない|
|ヒープの整合性の検証|システムとアプリ レベル|TerminateOnError|監査が利用できない|
|任意のコード ガード (ACG)|アプリ レベルのみ|DynamicCode|AuditDynamicCode|
|整合性が低いイメージのブロック|アプリ レベルのみ|BlockLowLabel|AuditImageLoad|
|リモート イメージのブロック|アプリ レベルのみ|BlockRemoteImages|監査が利用できない|
|信頼されていないフォントのブロック|アプリ レベルのみ|DisableNonSystemFonts|AuditFont, FontAuditOnly|
|コードの整合性ガード|アプリ レベルのみ|BlockNonMicrosoftSigned,AllowStoreSigned|AuditMicrosoftSigned、AuditStoreSigned|
|拡張ポイントの無効化|アプリ レベルのみ|ExtensionPoint|監査が利用できない|
|Win32k システム コールの無効化|アプリ レベルのみ|DisableWin32kSystemCalls|AuditSystemCall|
|子プロセスを許可しない|アプリ レベルのみ|DisallowChildProcessCreation|AuditChildProcess|
|エクスポート アドレス フィルター (EAF)|アプリ レベルのみ|EnableExportAddressFilterPlus, EnableExportAddressFilter <a href="#r1" id="t1"> \[ 1 \] </a>|監査は使用<a href="#r2" id="t2"> \[ できません \] 2</a>|
|インポート アドレス フィルター (IAF)|アプリ レベルのみ|EnableImportAddressFilter|監査は使用<a href="#r2" id="t2"> \[ できません \] 2</a>|
|実行のシミュレート (SimExec)|アプリ レベルのみ|EnableRopSimExec|監査は使用<a href="#r2" id="t2"> \[ できません \] 2</a>|
|API 呼び出しの検証 (CallerCheck)|アプリ レベルのみ|EnableRopCallerCheck|監査は使用<a href="#r2" id="t2"> \[ できません \] 2</a>|
|ハンドルの使用状態の検証|アプリ レベルのみ|StrictHandle|監査が利用できない|
|軽減策の依存関係の整合性の検証|アプリ レベルのみ|EnforceModuleDepencySigning|監査が利用できない|
|スタックの整合性の検証 (StackPivot)|アプリ レベルのみ|EnableRopStackPivot|監査は使用<a href="#r2" id="t2"> \[ できません \] 2</a>|

<a href="#t1" id="r1"> \[ 1 \] </a>: プロセスの DLL の EAF モジュールを有効にするには、次の形式を使用します。

```PowerShell
Set-ProcessMitigation -Name processName.exe -Enable EnableExportAddressFilterPlus -EAFModules dllName1.dll,dllName2.dll
```

<a href="#t2" id="r2"> \[ 2 \] </a>: この軽減策の監査は、PowerShell コマンドレットでは使用できません。

## <a name="customize-the-notification"></a>通知をカスタマイズする

ルールがトリガーされ、アプリまたはファイルがブロックされる通知のカスタマイズの詳細については、「Windows セキュリティ」 を[参照してください](/windows/security/threat-protection/windows-defender-security-center/windows-defender-security-center)。

## <a name="see-also"></a>関連項目

- [エクスプロイトからデバイスを保護する](exploit-protection.md)
- [エクスプロイト保護の評価](evaluate-exploit-protection.md)
- [エクスプロイト保護を有効にする](enable-exploit-protection.md)
- [エクスプロイト保護構成のインポート、エクスポート、展開](import-export-exploit-protection-emet-xml.md)
