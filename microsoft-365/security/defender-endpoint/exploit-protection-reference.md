---
title: エクスプロイト保護のリファレンス
keywords: 軽減策、脆弱性、脆弱性、軽減策、エクスプロイト、攻略、emet
description: エクスプロイト保護機能の動作の詳細については、Windows
ms.pagetype: security
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
ms.localizationpriority: medium
audience: ITPro
author: denisebmsft
ms.author: deniseb
ms.date: 10/19/2021
ms.reviewer: cjacks
manager: dansimp
ms.custom: asr
ms.technology: mde
ms.topic: article
ms.collection: m365-security-compliance
ms.openlocfilehash: d4bb0107c53c7fcbaee59d1db46d676fe407821b
ms.sourcegitcommit: e09ced3e3628bf2ccb84d205d9699483cbb4b3b0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/09/2021
ms.locfileid: "60884087"
---
# <a name="exploit-protection-reference"></a>エクスプロイト保護リファレンス

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**適用対象:**
- [Microsoft Defender for Endpoint](https://go.microsoft.com/fwlink/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

> Microsoft Defender ATP を試してみたいですか? [無料試用版にサインアップしてください。](https://signup.microsoft.com/create-account/signup?products=7f379fee-c4f9-4278-b0a1-e4c8c2fcdf7e&ru=https://aka.ms/MDEp2OpenTrial?ocid=docs-wdatp-enablesiem-abovefoldlink)

エクスプロイト保護は、開発者がソフトウェアをコンパイルして配布した後Pro適用できるアプリケーションの高度な保護を提供します。

この記事では、エクスプロイト保護ポリシーの構築と適用に役立つ、ポリシー レベルと個別の軽減レベルの両方で、エクスプロイト保護のしくみを理解するのに役立ちます。

## <a name="how-mitigations-are-applied"></a>軽減策の適用方法

Exploit Protection の軽減策は、アプリケーションごとに適用されます。

軽減策は、保護を構成する各プログラムのレジストリ エントリを介して構成されます。 これらの設定は、各プログラムの **MitigationOptions** レジストリ エントリ **(HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ *ImageFileName* \ MitigationOptions**) に格納されます。 これらは、プログラムを再起動すると有効になります。変更してプログラムを再起動するまで有効です。

> [!IMPORTANT]
> Image File Execution Options では、ファイル名またはパスのみを指定できます。バージョン番号、アーキテクチャ、その他の差別化要因は指定しません。 一意の名前またはパスを持つアプリに軽減策を適用し、そのバージョンとアプリケーションのアーキテクチャをテストしたデバイスにのみ適用してください。

PowerShell、グループ ポリシー、MDM を使用して XML 構成ファイルを使用して悪用防止の軽減策を構成すると、この XML 構成ファイルを処理するときに、個々のレジストリ設定が構成されます。

XML ファイルを配布するポリシーが適用されなくなった場合、この XML 構成ファイルによって展開された設定は自動的に削除されません。 Exploit Protection の設定を削除するには、クリーン なデバイスまたは 11 Windows 10または 11 Windowsから XML 構成をエクスポートし、この新しい XML ファイルを展開します。 または、Microsoft は、エクスプロイト保護の設定をリセットWindows セキュリティベースラインの一部として XML ファイルを提供します。

PowerShell を使用してエクスプロイト保護設定をリセットするには、次のコマンドを使用できます。

```powershell
Set-ProcessMitigation -PolicyFilePath EP-reset.xml
```
次に示すEP-reset.xmlベースラインとWindows セキュリティします。
```xml
<?xml version="1.0" encoding="UTF-8"?>
<MitigationPolicy>
  <AppConfig Executable="ONEDRIVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR OverrideRelocateImages="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
  </AppConfig>
  <AppConfig Executable="firefox.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
  </AppConfig>
  <AppConfig Executable="fltldr.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="GROOVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="Acrobat.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="AcroRd32.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="chrome.exe">
    <DEP OverrideDEP="false" />
  </AppConfig>
  <AppConfig Executable="EXCEL.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="iexplore.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="INFOPATH.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="java.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaw.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaws.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="LYNC.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSACCESS.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSPUB.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OIS.EXE">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OUTLOOK.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="plugin-container.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="POWERPNT.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="PPTVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VISIO.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VPREVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="WINWORD.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wmplayer.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wordpad.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
</MitigationPolicy>
```

## <a name="mitigation-reference"></a>軽減のリファレンス

以下のセクションでは、各エクスプロイト保護の軽減策によって提供される保護、軽減策の互換性に関する考慮事項、および使用可能な構成オプションについて詳しく説明します。

## <a name="arbitrary-code-guard"></a>任意のコード ガード

### <a name="description"></a>説明

任意のコード ガードは、メモリの安全性の脆弱性を通じて、任意のコードをメモリに読み込み、そのコードを実行できる悪意のある攻撃者から保護するのに役立ちます。

任意のコード ガードは、アプリケーションが動的に生成されたコード (たとえば、exe 自体または dll から読み込まれないコード) を実行から保護します。 任意のコード ガードは、メモリが実行可能ファイルとしてマークされるのを防ぐことによって機能します。 アプリケーションがメモリを割り [当てしようとすると](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)、保護フラグがチェックされます。 (メモリは、読み取り、書き込み、および/または実行保護フラグを使用して割り当てできます)。割り当てが実行保護フラグを[](/windows/win32/memory/memory-protection-constants)含もうとすると、メモリ割り当ては失敗し、エラー コード (STATUS_DYNAMIC_CODE_BLOCKED) を返します。 同様に、アプリケーションが既に割[](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect)り当てられているメモリの保護フラグを変更し、実行保護フラグを[](/windows/win32/memory/memory-protection-constants)含む場合、アクセス許可の変更は失敗し、エラー コード (STATUS_DYNAMIC_CODE_BLOCKED) を返します。

実行 *フラグが設定* されるのを防ぐことで、Windows 10 および Windows 11 のデータ実行防止機能は、そのメモリに設定され、そのコードを実行している命令ポインターから保護できます。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

任意のコード ガードを使用すると、メモリが実行可能ファイルとして割り当てられるのを防ぎ、Just-in-Time (JIT) コンパイラなどのアプローチとの互換性の問題が発生します。 たとえば、最新のほとんどのブラウザーでは、パフォーマンスを最適化するために JavaScript をネイティブ コードにコンパイルします。 この軽減策をサポートするには、JIT コンパイルを保護されたプロセスの外部に移動するために、再検出する必要があります。 スクリプトまたは他の中間言語からコードを動的に生成する他のアプリケーションも、この軽減策と同様に互換性がありません。

### <a name="configuration-options"></a>構成オプション

**[スレッドのオプトアウトを許可** する] - 個々のスレッドがこの保護をオプトアウトすることを許可する軽減策を構成できます。 開発者は、この軽減策を認識してアプリケーションを記述し、このスレッドで動的コードを実行するために *ThreadInformation* パラメーターを **ThreadDynamicCodePolicy** に設定した [**SetThreadInformation**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadinformation) API を呼び出している必要があります。

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="block-low-integrity-images"></a>整合性が低いイメージのブロック

### <a name="description"></a>説明

低整合性イメージをブロックすると、アプリケーションは、通常、セキュリティで保護されたブラウザーからインターネットからダウンロードされたため、信頼されていないファイルを読み込むのを防ぐ。

この軽減策は、イメージに低 IL プロセスへのアクセスを許可するアクセス制御エントリ (ACE) を持ち、信頼ラベル ACE を持つイメージの読み込みをブロックします。 メモリ マネージャーによって実装され、ファイルがメモリにマップされるのをブロックします。 アプリケーションが低整合性イメージをマップしようとすると、エラーが発生STATUS_ACCESS_DENIEDされます。 整合性レベルの動作の詳細については [、「Mandatory Integrity Control」を参照してください](/windows/win32/secauthz/mandatory-integrity-control)。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

低整合性イメージをブロックすると、アプリケーションはインターネットからダウンロードされたファイルを読み込むのを防ぐ。 アプリケーション ワークフローでダウンロードされたイメージの読み込みが必要な場合は、高信頼プロセスからダウンロードするか、この軽減策を適用するために明示的に再ラベルが付けられている必要があります。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="block-remote-images"></a>リモート イメージのブロック

### <a name="description"></a>説明

リモート イメージをブロックすると、アプリケーションが UNC 共有などのリモート デバイスでホストされているファイルを読み込むのを防ぐのに役立ちます。 リモート イメージをブロックすると、攻撃者が制御する外部デバイス上のメモリにバイナリを読み込むのを防止できます。

この軽減策は、イメージがリモート デバイス上に含まれると判断された場合、イメージの読み込みをブロックします。 メモリ マネージャーによって実装され、ファイルがメモリにマップされるのをブロックします。 アプリケーションがリモート ファイルをマップしようとすると、エラーが発生STATUS_ACCESS_DENIEDされます。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

リモート イメージをブロックすると、アプリケーションはリモート デバイスからイメージを読み込むのを防ぐ。 アプリケーションがリモート デバイスからファイルまたはプラグインを読み込む場合、この軽減策と互換性がありません。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="block-untrusted-fonts"></a>信頼されていないフォントのブロック

### <a name="description"></a>説明

信頼されていないフォントをブロックすると、デバイス上でコードを実行できる攻撃者につながるフォント解析の欠陥のリスクが軽減されます。 Windows\fonts ディレクトリにインストールされているフォントだけが、GDI による処理のために読み込まれます。

この軽減策は、ファイルの場所を検証する GDI 内で実装されます。 ファイルがシステム フォント ディレクトリに存在しない場合、フォントは解析用に読み込まれなく、その呼び出しは失敗します。

この軽減策は、Windows 10 1607 以降、および Windows 11 で提供される組み込みの軽減策に加えて、フォント解析をカーネルからユーザー モード アプリ コンテナーに移動します。 その結果、フォント解析に基づくエクスプロイトは、サンドボックスで分離されたコンテキストで発生し、リスクを大幅に軽減します。 この軽減策の詳細については、「0 日間のエクスプロイトの軽減策をWindows 10のセキュリティ強化に関するブログ[」を参照してください](https://www.microsoft.com/security/blog/2017/01/13/hardening-windows-10-with-zero-day-exploit-mitigations/)。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

システム フォント ディレクトリ外のフォントの最も一般的な使用は [、Web](/typography/fonts/font-faq#web)フォントです。 最新のブラウザー (Microsoft Edge GDI ではなくDirectWriteを使用し、影響を受け取る必要はありません。 ただし、Internet Explorer 11 などの従来のブラウザー (および新しい Microsoft Edge の IE モード) は、特にフォント グリフを使用して UI を表示する Office 365 などのアプリケーションに影響を与える可能性があります。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="code-integrity-guard"></a>コードの整合性ガード

### <a name="description"></a>説明

コード整合性ガードを使用すると、プロセスに読み込まれるすべてのバイナリが Microsoft によってデジタル署名されます。 コード整合性ガードには[、WHQL](/windows-hardware/drivers/install/whql-release-signature) (Windows品質ラボ) の署名が含まれています。この署名を使用すると、WHQL で承認されたドライバーをプロセス内で実行できます。

この軽減策はメモリ マネージャー内で実装され、バイナリがメモリにマップされるのをブロックします。 Microsoft によって署名されていないバイナリを読み込む場合、メモリ管理はエラー メッセージをSTATUS_INVALID_IMAGE_HASH。 メモリ マネージャー レベルでブロックすると、プロセスによって読み込まれるバイナリと、プロセスに挿入されたバイナリの両方が防止されます。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

この軽減策は、特に Microsoft によって署名されていないバイナリをブロックします。 そのため、ソフトウェアが Microsoft Store によって配布 (およびデジタル署名) され、Microsoft Store によって署名されたイメージの読み込みを許可するオプションが選択されていない限り、ほとんどのサードパーティ ソフトウェアと互換性がありません。

### <a name="configuration-options"></a>構成オプション

**Microsoft Store** によって署名されたイメージの読み込みも許可する - Microsoft Store によって配布されるアプリケーションは、Microsoft Store によってデジタル署名され、この構成を追加すると、ストア認定プロセスを通過したバイナリをアプリケーションによって読み込まれます。

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="control-flow-guard-cfg"></a>制御フロー ガード (CFG)

### <a name="description"></a>説明

コントロール フロー ガード (CFG) は、間接的な関数呼び出しを保護することで、メモリ破損の脆弱性を使用する攻撃者のリスクを軽減します。 たとえば、攻撃者はバッファー オーバーフローの脆弱性を利用して、関数ポインターを含むメモリを上書きし、その関数ポインターを任意の実行可能コード (プログラムに挿入されている可能性があります) へのポインターに置き換える可能性があります。

この軽減策は、コンパイル時に別のチェックを挿入することで提供されます。 各間接関数呼び出しの前に、ターゲットが呼び出される前に有効な呼び出し先を確認する別の命令が追加されます。 ターゲットが有効な呼び出し先でない場合、アプリケーションは終了します。 そのため、この軽減策を利用できるのは、CFG サポートを使用してコンパイルされたアプリケーションのみです。

有効なターゲットのチェックは、カーネルによってWindowsされます。 実行可能ファイルが読み込まれると、間接呼び出しターゲットのメタデータが読み込み時に抽出され、有効な呼び出し先としてマークされます。 さらに、メモリを割り当て、実行可能ファイル (生成されたコードなど) としてマークすると、これらのメモリの場所も有効な呼び出し先としてマークされ、JIT コンパイルなどのメカニズムをサポートします。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

アプリケーションは CFG をサポートするためにコンパイルする必要があるから、アプリケーションとの互換性を暗黙的に宣言します。 したがって、ほとんどのアプリケーションは、この軽減策を有効にした場合に動作する必要があります。 これらのチェックはバイナリにコンパイルされますので、適用できる構成は、カーネル内のチェックを無効にWindowsです。 つまり、軽減策は既定でオンになっていますが、後でアプリケーション開発者がテストで検出しなかった互換性の問題が発生したと判断した場合は、常に "はい" を返す Windows カーネルを構成できます。これはまれなはずです。

### <a name="configuration-options"></a>構成オプション

厳密 **な CFG** を使用する - 厳密なモードでは、プロセスに読み込まれるすべてのバイナリを Control Flow Guard 用にコンパイルする必要があります (または、リソース dll など、実行可能コードが含まれません)。

> [!Note]
> **コントロール フロー ガードには** 監査モードはありません。 バイナリは、この軽減策が有効になっているとコンパイルされます。

## <a name="data-execution-prevention-dep"></a>データ実行防止 (DEP)

### <a name="description"></a>説明

データ実行防止 (DEP) は、実行可能ファイルとして明示的に割り当てられていないメモリが実行されるのを防ぐ。 DEP は、バッファー オーバーフローなどの悪意のあるコードをプロセスに挿入し、そのコードを実行する攻撃者から保護するのに役立ちます。

命令ポインターを実行可能ファイルとしてマークされていないメモリ アドレスに設定しようとすると、プロセッサは例外 (一般保護違反) をスローし、アプリケーションがクラッシュします。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

すべての x64、ARM、ARM-64 の実行可能ファイルには既定で DEP が有効になっているので、無効にすることはできません。 アプリケーションは DEP なしで実行されたことがないので、互換性が前提となります。

すべての x86 (32 ビット) バイナリでは、既定で DEP が有効になっていますが、プロセスごとに DEP を無効にできます。 一部の古いレガシ アプリケーション (通常は XP SP2 より前に開発Windowsアプリケーション) は、DEP と互換性がない場合があります。 このようなアプリケーションは、通常、コードを動的に生成する (JIT コンパイルなど)、またはコードを動的に生成する古いライブラリ (ATL の古いバージョンなど) へのリンクを生成します。

### <a name="configuration-options"></a>構成オプション

**ATL Thunk エミュレーションを有効** にする - この構成オプションは、ATL Thunk エミュレーションを無効にします。 ATL (ActiveX テンプレート ライブラリ) は、可能な限り小さく、高速に設計されています。 バイナリ サイズを小さくするには、サンクと呼ばれる手法 *を使用します*。 サンクは通常、32 ビットと 16 ビットの間のアプリケーションを操作するために考え出されますが、ここでは ATL に 16 ビット コンポーネントはありません。 代わりに、バイナリ サイズを最適化するために、ATL は、ワードアラインされていない (小さいバイナリを作成する) コンピューター コードをメモリに格納し、そのコードを直接呼び出します。 Visual Studio 7.1 以前 (Visual Studio 2003) でコンパイルされた ATL コンポーネントは、このメモリを実行可能ファイルとして割り当てない - サンク エミュレーションは、その互換性の問題を解決します。 バイナリ拡張モデル (Internet Explorer 11 など) を持つアプリケーションでは、ATL Thunk エミュレーションを有効にする必要があります。

## <a name="disable-extension-points"></a>拡張ポイントの無効化

### <a name="description"></a>説明

この軽減策は、アプリケーションのさまざまな拡張ポイントを無効にします。これは、悪意のあるコンテンツの永続性を確立したり、特権を昇格したりするために使用される可能性があります。

これには、次の内容が含まれます。

- **AppInit DLL** - プロセスが開始されるたびに、システムは指定した DLL を新しく開始したプロセスのコンテキストに読み込んでから、そのエントリ ポイント関数を呼び出します。 [AppInit DLL の詳細については、こちらを参照してください](/windows/win32/winmsg/about-window-classes#application-global-classes)。 この軽減策が適用されると、AppInit DLL は読み込まれません。 7 からWindows AppInit DLL は、ここで説明するようにデジタル署名[する必要があります](/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2)。 さらに、ここで説明Windows 8、SecureBoot が有効になっている場合、AppInit DLL は[読み込まれません](/windows/win32/dlls/secure-boot-and-appinit-dlls)。
- **従来の IMEs** - 入力メソッド エディター (IME) を使用すると、ユーザーはキーボードで表す文字よりも多くの文字を持つ言語でテキストを入力できます。 サード パーティは IMEs を作成できます。 悪意のある IME は、この入力キャプチャから資格情報や他の機密情報を取得する可能性があります。 従来の IMEs と呼ばれる一部の IMEs は、UWP アプリではなく、Windows デスクトップ アプリでのみ動作します。 この軽減策により、この従来の IME が指定したデスクトップ アプリに読み込Windows防ぐことも可能です。
- **Windowsフック**- アプリケーションは [SetWinEventHook API](/windows/win32/api/winuser/nf-winuser-setwineventhook)を呼び出して、発生するイベントへの関心を登録できます。 DLL が指定され、プロセスに挿入できます。 この軽減策は、挿入された DLL を介してインプロセスを実行するのではなく、登録プロセスにフックを強制的に投稿します。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

これらの拡張ポイントの大部分は比較的頻繁に使用されないので、互換性への影響は通常、特に個々のアプリケーション レベルで小さくても問題はありません。 1 つの考慮事項は、ユーザーが保護されたアプリケーションで動作しないサードパーティの従来の IMEs を使用している場合です。

### <a name="configuration-options"></a>構成オプション

この軽減策の構成オプションはありません。

> [!Note]
> **拡張機能ポイントを無効に** した場合、監査モードはありません。

## <a name="disable-win32k-system-calls"></a>Win32k システム コールの無効化

### <a name="description"></a>説明

Win32k.sysは、攻撃者に広範な攻撃の表面を提供します。 カーネル モード コンポーネントとして、サンドボックス化されたアプリケーションのエスケープ ベクトルとして頻繁に対象とされます。 この軽減策は、スレッドwin32k.sys自体を GUI スレッドに変換し、Win32k 関数を呼び出すアクセス権を与えられるのをブロックすることで、ユーザーに対する呼び出しを防止します。 スレッドは、作成時には GUI 以外ですが、最初の呼び出しで win32k.sys または [IsGuiThread](/windows/win32/api/winuser/nf-winuser-isguithread)への API 呼び出しで変換されます。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

この軽減策は、専用の非 UI プロセスであるプロセス用に設計されています。 たとえば、多くの最新のブラウザーでは、プロセス分離を使用し、UI 以外のプロセスを組み込む必要があります。 1 つのプロセスを使用して GUI を表示するアプリケーションは、この軽減策の影響を受け取る可能性があります。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="do-not-allow-child-processes"></a>子プロセスを許可しない

### <a name="description"></a>説明

この軽減策により、アプリケーションは新しい子アプリケーションを作成できます。 敵対者が使用する一般的な手法は、悪意のある入力 ("土地から離れ" 攻撃) を使用してデバイス上で信頼できるプロセスを開始する方法です。多くの場合、デバイス上で別のアプリケーションを起動する必要があります。 アプリケーションが子プロセスを起動する正当な理由がない場合、この軽減策は、その潜在的な攻撃ベクトルを軽減します。 この軽減策は、プロセス トークンにプロパティを設定することで適用されます。これは、エラー メッセージが表示された子プロセスのトークンを作成STATUS_CHILD_PROCESS_BLOCKED。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

ブラウザーや外部ブラウザーを起動するハイパーリンクのサポート、コンピューター上で他のユーティリティを起動するハイパーリンクなど、何らかの理由でアプリケーションが子アプリケーションを起動した場合、この機能は、この軽減策が適用された時点で壊れます。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="export-address-filtering"></a>アドレス フィルターのエクスポート

### <a name="description"></a>説明

エクスポート アドレス フィルター (EAF) は、読み込まれたすべてのモジュールのエクスポート アドレス テーブルを見て、攻撃に役立つ API を含むモジュールを検索する悪意のあるコードのリスクを軽減します。 これは、シェルコードで使用される一般的な方法です。 このような攻撃のリスクを軽減するために、この軽減策は一般的に攻撃される 3 つのモジュールを保護します。

- ntdll.dll
- kernelbase.dll
- kernel32.dll

この軽減策は、[エクスポート アドレス テーブルをポイントするエクスポート ディレクトリ内のメモリ ページ [を保護します](/windows/win32/debug/pe-format#export-address-table)。 このメモリ ページには [、PAGE_GUARD保護](/windows/win32/memory/creating-guard-pages) が適用されます。 他のユーザーがこのメモリにアクセスしようとすると、そのメモリがSTATUS_GUARD_PAGE_VIOLATION。 この軽減策は、この例外を処理し、アクセス命令が検証に合格しない場合、プロセスは終了します。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

この軽減策は、デバッガー、サンドボックス アプリケーション、DRM を使用するアプリケーション、デバッグ対策テクノロジを実装するアプリケーションなどのアプリケーションの主な問題です。

### <a name="configuration-options"></a>構成オプション

**悪用によって一般的に** 悪用されるモジュールのアクセスを検証する - このオプションは、EAF+とも呼ばれる、他の一般的に攻撃されるモジュールの保護を追加します。

- `mshtml.dll`
- `flash*.ocx`
- `jscript*.ocx`
- `vbscript.dll`
- `vgx.dll`
- `mozjs.dll`
- `xul.dll`
- `acrord32.dll`
- `acrofx32.dll`
- `acroform.api`

さらに、EAF+ を有効にすると、この軽減策は、PE ファイル内の [DOS](/windows/win32/debug/pe-format#ms-dos-stub-image-only)ヘッダーの最初の 2 バイトである "MZ" ヘッダーを含むページに PAGE_GUARD 保護を追加します。これは、シェルコードがメモリに関心を持つ可能性のあるモジュールを識別するために検索できる既知のメモリ コンテンツのもう 1 つの側面です。

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="force-randomization-for-images-mandatory-aslr"></a>イメージのランダム化の強制 (必須 ASLR)

### <a name="description"></a>説明

アドレス空間レイアウトランダム化 (ASLR) は、プロセス メモリに既に存在し、既に実行可能としてマークされているコードを実行するために、システムのメモリ レイアウトに関する知識を使用する攻撃者のリスクを軽減します。 これにより、攻撃者が return-to-libc 攻撃などの手法を使用して、攻撃者がコンテキストを設定し、戻りアドレスを変更して、敵の目的に合ったコンテキストで既存のコードを実行するリスクを軽減できます。

必須の ASLR では、プロセス内のすべての DLL の再ベースが強制されます。 開発者は [、/DYNAMICBASE](/cpp/build/reference/dynamicbase-use-address-space-layout-randomization) リンカー オプションを使用して ASLR を有効にできます。この軽減効果も同じです。

メモリ マネージャーがイメージ内でプロセスにマッピングしている場合、必須 ASLR は ASLR にオプトインしていない DLL と EXEs を強制的にリベースします。 ただし、このリバスはエントロピーを持たず、メモリ内の予測可能な場所に配置できます。 バイナリの再ベースおよびランダム化された場所の場合、この軽減策は、ランダム化メモリ割り当 [て (ボトムアップ ASLR)](#randomize-memory-allocations-bottom-up-aslr)とペアにする必要があります。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

ASLR のこの互換性への影響は、通常、バイナリ ファイルの基本アドレスを前提にしたコンパイラを使用して構築された古いアプリケーションや、基本再配置情報を削除した古いアプリケーションに制限されます。 これにより、実行フローがメモリ内の実際の場所ではなく、予想される場所にジャンプしようとすると、予測できないエラーが発生する可能性があります。

### <a name="configuration-options"></a>構成オプション

**削除された画像を許可しない** - このオプションは、再配置情報が削除されたイメージの読み込みをブロックします。 Windows PE ファイル形式には絶対アドレスが含まれます。また、コンパイラは [基本再配置テーブルを生成し、ローダーは、すべての相対メモリ参照とそのオフセットを検索するために使用できます。バイナリが優先ベース アドレスで読み込めない場合は更新できます。 一部の古いアプリケーションでは、実稼働ビルドでこの情報を削除するため、これらのバイナリを再ベース化することはできません。 この軽減策は、このようなバイナリが読み込まれるのをブロックします (優先する基本アドレスで読み込む代わりに)。

> [!Note]
> **イメージの強制的なランダム化 (必須 ASLR) には** 監査モードはありません。

## <a name="import-address-filtering-iaf"></a>インポート アドレス フィルター (IAF)

### <a name="description"></a>説明

インポート アドレス フィルター (IAF) の軽減は、インポート アドレス テーブル (IAT) を変更して、その関数が呼び出された際に攻撃者が選択した任意のコードにリダイレクトすることで、アプリケーションの制御フローを変更する敵のリスクを軽減するのに役立ちます。 攻撃者は、このアプローチを使用して制御をハイジャックしたり、機密性の高い API への呼び出しを傍受、検査、ブロックしたりする可能性があります。

すべての保護された API のメモリ ページには、PAGE_GUARD [保護が](/windows/win32/memory/creating-guard-pages) 適用されます。 他のユーザーがこのメモリにアクセスしようとすると、そのメモリがSTATUS_GUARD_PAGE_VIOLATION。 この軽減策は、この例外を処理し、アクセス命令が検証に合格しない場合、プロセスは終了します。

この軽減策は、次の API Windows保護します。

- `GetProcAddress`
- `GetProcAddressForCaller`
- `LoadLibraryA`
- `LoadLibraryExA`
- `LoadLibraryW`
- `LoadLibraryExW`
- `LdrGetProcedureAddress`
- `LdrGetProcedureAddressEx`
- `LdrGetProcedureAddressForCaller`
- `LdrLoadDll`
- `VirtualProtect`
- `VirtualProtectEx`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `NtProtectVirtualMemory`
- `CreateProcessA`
- `CreateProcessW`
- `WinExec`
- `CreateProcessAsUserA`
- `CreateProcessAsUserW`
- `GetModuleHandleA`
- `GetModuleHandleW`
- `RtlDecodePointer`
- `DecodePointer`

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

API インターセプトを実行する正当なアプリケーションは、この軽減策によって検出され、一部のアプリケーションがクラッシュする可能性があります。 たとえば、セキュリティ ソフトウェアとアプリケーションの互換性 shim が含まれます。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="randomize-memory-allocations-bottom-up-aslr"></a>メモリ割り当てをランダム化する (ボトムアップ ASLR)

### <a name="description"></a>説明

メモリ割り当てをランダム化 (ボトムアップ ASLR) を使用すると、再配置にエントロピーが追加されるため、場所はランダム化されるため、予測が難しになります。 この軽減策を有効にするためには、必須の ASLR が必要です。

32 ビット アドレス空間のサイズは、追加できるエントロピーに実用的な制約を与えるので、64 ビット アプリケーションでは、攻撃者がメモリ内の場所を推測するのが難しくなります。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

必須 ASLR (リベース) と互換性のあるほとんどのアプリケーションは、ボトムアップ ASLR の他のエントロピーにも対応しています。 一部のアプリケーションでは、ローカル ポインターを 32 ビット変数 (4 GB 以下のベース アドレスを必要とします) に保存する場合にポインター切り捨ての問題が発生する可能性があります。そのため、高エントロピー オプション (無効にできる) と互換性がありません。

### <a name="configuration-options"></a>構成オプション

高エントロピーを使用しない **-** このオプションは、64 ビット アプリケーションのボトムアップ割り当てに 24 ビットのエントロピー (分散 1 TB) を追加する、高エントロピー ASLR の使用を無効にします。

> [!Note]
> **メモリ割り当てのランダム化 (ボトムアップ ASLR) には** 監査モードはありません。

## <a name="simulate-execution-simexec"></a>実行のシミュレート (SimExec)

### <a name="description"></a>説明

シミュレーション実行 (SimExec) は、32 ビット アプリケーションの軽減策です。 これにより、機密性の高い API への呼び出しが正当な呼び出し元関数に戻る検証に役立ちます。 これは、機密性の高い API への呼び出しを傍受し、呼び出し元に返す RET 命令を探すエンコードされたアセンブリ言語命令を実行して、それらの API の実行をシミュレートすることで行います。 次に、その関数を検査し、メモリ内を後方に移動して、前の CALL 命令を見つけて、関数と CALL 命令が一致するかどうか、および RET が傍受されていないかどうかを判断します。

この軽減策によって傍受される API は次のとおりです。

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

ROP ガジェットが検出されると、プロセスは終了します。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。

この軽減策は、任意のコード ガードの軽減策と互換性がありません。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="validate-api-invocation-callercheck"></a>API 呼び出しの検証 (CallerCheck)

### <a name="description"></a>説明

検証 API 呼び出し (CallerCheck) は、有効な呼び出し元から機密性の高い API が呼び出されたのを検証する、戻り値指向プログラミング (ROP) 手法の軽減策です。 この軽減策は、渡された戻りアドレスを検査し、ヒューリスティックに逆アセンブルして、戻り値アドレスの上に呼び出しを見つけて、呼び出し先が関数に渡されたパラメーターと一致するかどうかを判断します。

この軽減策によって傍受される API は次のとおりです。

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

ROP ガジェットが検出されると、プロセスは終了します。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。

この軽減策は、任意のコード ガードの軽減策と互換性がありません。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="validate-exception-chains-sehop"></a>例外チェーンの検証 (SEHOP)

### <a name="description"></a>説明

例外チェーン (SEHOP) の検証は、構造化例外ハンドラー *(SEH)* 上書き悪用手法に対する軽減策です。 [構造化例外処理とは](/windows/win32/debug/structured-exception-handling) 、アプリケーションが特定の例外の処理を要求できるプロセスです。 例外ハンドラーは一緒にチェーン処理され、ある例外ハンドラーが特定の例外を処理しない場合は、処理を決定するまでチェーン内の次の例外ハンドラーに渡されます。 ハンドラーの一覧は動的なので、スタックに格納されます。 攻撃者はスタック オーバーフローの脆弱性を使用して、例外ハンドラーを攻撃者が選択したコードへのポインターで上書きできます。

この軽減策は、各 SEH エントリに例外ハンドラーへのポインターと、例外チェーン内の次のハンドラーへのポインターの両方が含まれる SEH の設計に依存します。 この軽減策は、例外ディスパッチャーによって呼び出され、例外が呼び出されると SEH チェーンが検証されます。 次の情報が確認されます。

- すべての例外チェーン レコードがスタック境界内にある
- すべての例外レコードが揃っています
- スタックを指している例外ハンドラー ポインターはありません
- 下位ポインターはありません
- 例外チェーンは、既知の最終的な例外ハンドラーで終了します。

これらの検証が失敗した場合、例外処理は中止され、例外は処理されません。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

SEHOP との互換性の問題は比較的まれです。 アプリケーションが例外チェーンの破損に依存する場合はまれです。 ただし、一部のアプリケーションはタイミングの微妙な変化の影響を受け、アプリケーションの潜在的なマルチスレッド バグを明らかにする競争状態として現れる可能性があります。

### <a name="configuration-options"></a>構成オプション

> [!Note]
> **例外チェーン (SEHOP) に** 監査モードがないのを検証します。

## <a name="validate-handle-usage"></a>ハンドルの使用状態の検証

### <a name="description"></a>説明

*ハンドルの使用状況の検証* は、既存のハンドルを使用して保護されたオブジェクトにアクセスする攻撃者から保護するのに役立つ軽減策です。 ハンドル [は](/windows/win32/sysinfo/handles-and-objects) 、保護されたオブジェクトへの参照です。 アプリケーション コードが無効なハンドルを参照している場合、攻撃者が以前に記録したハンドルを使用しようとしている可能性があります (ただし、どのアプリケーション参照カウントが認識されません)。 アプリケーションが null を返すのではなく、無効なオブジェクトを使用しようとすると、アプリケーションは例外を発生します (STATUS_INVALID_HANDLE)。

この軽減策は、ストア アプリケーションにWindows適用されます。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

ハンドル参照を正確に追跡していないアプリケーション、および例外ハンドラーでこれらの操作をラップしていないアプリケーションは、この軽減策の影響を受け得る可能性があります。

### <a name="configuration-options"></a>構成オプション

> [!Note]
> **ハンドルの使用状況を検証** する監査モードはありません。

## <a name="validate-heap-integrity"></a>ヒープの整合性の検証

### <a name="description"></a>説明

ヒープ *整合性の検証の* 軽減は、ヒープの破損が検出された場合にアプリケーションを終了することで、Windows でのヒープ軽減の保護レベルを向上します。 軽減策には、次のものが含まれます。

- HEAP ハンドルが解放されるのを防ぐ
- ヒープ割り当ての拡張ブロック ヘッダーに対して別の検証を実行する
- ヒープ割り当てが既に使用済みとしてフラグが設定されていないか確認する
- 最小サイズを超えて大きな割り当て、ヒープ セグメント、およびサブセグメントにガード ページを追加する

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

この軽減策は、64 ビット アプリケーションおよび Vista 以降を対象とする 32 ビット アプリケーションWindows既に適用されています。 XP 以前のWindowsアプリケーションは最も危険にさらされています。互換性の問題はまれです。

### <a name="configuration-options"></a>構成オプション

> [!Note]
> **ヒープ整合性の検証には監査** モードはありません。

## <a name="validate-image-dependency-integrity"></a>軽減策の依存関係の整合性の検証

### <a name="description"></a>説明

検証 *イメージの依存関係の軽減* は、バイナリによって静的にリンクされている dll のコードを置き換える攻撃から保護するのにWindowsします。 DLL の植え付け手法は、ローダーの検索メカニズムを悪用して悪意のあるコードを挿入します。これは、悪意のあるコードを昇格されたコンテキストで実行するために使用できます。 ローダーが Windows 署名されたバイナリを読み込み、そのバイナリが依存する dll を読み込む場合、これらのバイナリは、Windows バイナリとしてデジタル署名も行うかどうか確認されます。 署名チェックに失敗した場合、dll は読み込まれないため、例外がスローされ、エラーの状態がSTATUS_INVALID_IMAGE_HASH。

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

互換性の問題は一般的ではありません。 Windows バイナリをローカルのプライベート バージョンに置き換えるのに依存するアプリケーションは影響を受け、マルチスレッド アプリケーションで微妙なタイミング バグが発生するリスクも少なからない。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。

## <a name="validate-stack-integrity-stackpivot"></a>スタックの整合性の検証 (StackPivot)

### <a name="description"></a>説明

スタック整合性の検証 *(StackPivot)* の軽減は、スタック ピボット攻撃(攻撃者がヒープ メモリ内に偽のスタックを作成する ROP 攻撃)から保護し、実行のフローを制御する偽のスタックにアプリケーションを戻すのに役立ちます。

この軽減策は、多Windows API を傍受し、スタック ポインターの値を検査します。 スタック ポインターのアドレスがスタックの下部と上の間に入らない場合は、イベントが記録され、監査モードではない場合、プロセスは終了します。

この軽減策によって傍受される API は次のとおりです。

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

### <a name="compatibility-considerations"></a>互換性に関する考慮事項

偽のスタックを使用しているアプリケーションは影響を受け、マルチスレッド アプリケーションで微妙なタイミング バグを明らかにするリスクも小さい。
API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。

この軽減策は、任意のコード ガードの軽減策と互換性がありません。

### <a name="configuration-options"></a>構成オプション

**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。 監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。
