---
title: ファイルレスの脅威
ms.reviewer: ''
description: 陸上に住むファイルレス脅威とマルウェアのカテゴリについて学ぶ
keywords: fileless, fileless malware, living off the land, lolbins, amsi, behavior monitoring, memory scanning, boot sector protection, security, Malware, Windows Defender ATP, ウイルス対策, AV, Microsoft Defender ATP, 次世代保護
ms.prod: m365-security
ms.mktglfcycl: secure
ms.sitesec: library
ms.localizationpriority: medium
ms.author: dansimp
author: dansimp
manager: dansimp
audience: ITPro
ms.collection: M365-security-compliance
ms.topic: article
search.appverid: met150
ms.technology: m365d
ms.openlocfilehash: 97545714ff468c7be238585ab5d137a1ac93a5f9
ms.sourcegitcommit: b3530441288b2bc44342e00e9025a49721796903
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/20/2022
ms.locfileid: "63681941"
---
# <a name="fileless-threats"></a>ファイルレスの脅威

ファイルレスの脅威とは何ですか? "fileless" という用語は、コンピューターのメモリにのみ存在するバックドアなど、ファイルに脅威が存在しないことを示しています。 ただし、ファイルレス マルウェアの定義は 1 つはありません。 この用語は広く使用され、操作するファイルに依存するマルウェア ファミリを記述する場合があります。

攻撃には、 [実行、永続](https://attack.mitre.org/wiki/ATT&CK_Matrix) 化、情報の盗難など、機能のいくつかの段階が含まれる。 攻撃チェーンの一部がファイルレスである場合と、ファイル システムが何らかの形で含まれる場合があります。

分かりやすくするために、ファイルレスの脅威は異なるカテゴリにグループ化されます。

![ファイルレス マルウェアの包括的な図。](../../media/security-intelligence-images/fileless-malware.png)<br>
*図 1.ファイルレス マルウェアの包括的な図*

ファイルレスの脅威は、ファイルレス マルウェアがコンピューターに到着する方法を示すエントリ ポイントによって分類できます。 セキュリティ侵害されたハードウェアを介して、またはアプリケーションとスクリプトの定期的な実行を介して、悪用を介して到着することができます。

次に、エントリ ポイントの形式を一覧表示します。 たとえば、悪用はファイルやネットワーク データに基づく場合、PCI 周辺機器はハードウェア ベクトルの一種であり、スクリプトと実行可能ファイルは実行ベクトルのサブカテゴリです。

最後に、感染のホストを分類します。 たとえば、Flash アプリケーションには、悪用、単純な実行可能ファイル、ハードウェア デバイスからの悪意のあるファームウェアなど、さまざまな脅威が含まれている場合があります。

分類は、さまざまな種類のファイルレス脅威を分割および分類するのに役立ちます。 一部のユーザーは、より危険ですが、実装が難しくなりますが、高度ではないにもかかわらず (または正確には) 使用される方が一般的です。

この分類から、感染したコンピューターに残される可能性がある指紋の量に基づいて、3 つの主要な種類のファイルレス脅威を取得できます。

## <a name="type-i-no-file-activity-performed"></a>タイプ I: ファイル アクティビティが実行されません

完全にファイルレスのマルウェアは、ディスクにファイルを書き込む必要がないマルウェアと見なされます。 このようなマルウェアは、最初にコンピューターに感染する方法を示します。 1 つの例は、ターゲット コンピューターが、EternalBlue の脆弱性を悪用する悪意のあるネットワーク パケットを受け取る場所です。 この脆弱性により、DoublePulsar バックドアがインストールされ、カーネル メモリにのみ存在します。 この場合、ファイルまたはファイルに書き込まれたデータはありません。

また、侵害されたデバイスでは、デバイス のファームウェア (BIOS など)、USB 周辺機器 (BadUSB 攻撃など)、またはネットワーク カードのファームウェアに悪意のあるコードが隠されている可能性があります。 これらの例はすべて、ディスク上のファイルを実行する必要はなく、理論的にはメモリ内でのみ使用できます。 悪意のあるコードは、再起動、ディスクの再フォーマット、および OS の再インストールから生き残ります。

ほとんどのウイルス対策製品にはファームウェアを検査する機能がないので、この種類の感染は特に検出が困難な場合があります。 製品に悪意のあるファームウェアを検査して検出する機能がある場合でも、このレベルでの脅威の修復に関連する重大な課題があります。 この種類のファイルレス マルウェアは、高レベルの洗練が必要であり、多くの場合、特定のハードウェアまたはソフトウェア構成に依存します。 簡単かつ確実に悪用できる攻撃ベクトルではありません。 危険ですが、この種類の脅威はまれであり、ほとんどの攻撃では実用的ではありません。

## <a name="type-ii-indirect-file-activity"></a>タイプ II: 間接ファイル アクティビティ

他にも、マルウェアが機械上でファイルレスプレゼンスを実現する方法は、エンジニアリング作業を大幅に必要とせずに行うことができます。 この種類のファイルレス マルウェアは、ファイル システムにファイルを直接書き込むのではなく、間接的にファイルを使用する可能性があります。 たとえば、 [Poshspy](https://www.fireeye.com/blog/threat-research/2017/03/dissecting_one_ofap.html) バックドアの攻撃者が WMI リポジトリ内に悪意のある PowerShell コマンドをインストールし、コマンドを定期的に実行するように WMI フィルターを構成したとします。

このようなインストールは、ファイルにバックドアが既に存在する必要なく、コマンド ラインを介して実行できます。 マルウェアは、ファイル システムに触れることなく、インストールして理論的に実行できます。 ただし、WMI リポジトリは、CIM オブジェクト マネージャーによって管理される中央記憶域内の物理ファイルに格納され、通常は正当なデータが含まれます。 感染チェーンは技術的には物理ファイルを使用しますが、WMI リポジトリは検出および削除できない多目的データ コンテナーなので、ファイルレス攻撃と見なされます。

## <a name="type-iii-files-required-to-operate"></a>Type III: 操作に必要なファイル

一部のマルウェアは、ファイルレスの永続性を持つ可能性がありますが、ファイルを使用して動作しない場合があります。 このシナリオの例は、Kovter です。これは、ランダムなファイル拡張子のレジストリにシェルの開いている動詞ハンドラーを作成します。 このような拡張子を持つファイルを開くには、正当なツールを使用してスクリプトが実行mshta.exe。

![Kovter のレジストリ キーのイメージ。](../../media/security-intelligence-images/kovter-reg-key.png)<br>
*図 2.Kovter のレジストリ キー*

開いている動詞が呼び出されると、レジストリから関連付けられたコマンドが起動され、小さなスクリプトが実行されます。 このスクリプトは、追加のレジストリ キーからデータを読み取って実行し、最終的なペイロードの読み込みにつながる処理を実行します。 ただし、最初に開いている動詞をトリガーするには、Kovter が動詞の対象とする拡張子が同じファイルを削除する必要があります (上記の例では、拡張子は .bbf5590fd です)。 また、コンピューターの起動時にこのようなファイルを開く自動実行キーを設定する必要があります。

Kovter は、ファイル システムが実用的な使用ではないので、ファイルレスの脅威と見なされます。 ランダムな拡張子を持つファイルには、脅威の存在を確認する上では使用できない迷惑メール データが含まれている。 レジストリを格納するファイルは、悪意のあるコンテンツが存在する場合は検出および削除できないコンテナーです。

## <a name="categorizing-fileless-threats-by-infection-host"></a>感染ホストによるファイルレス脅威の分類

広範なカテゴリについて説明した後、詳細を掘り下げ、感染ホストの内訳を提供することができます。 この包括的な分類では、通常、ファイルレス マルウェアと呼ばれる内容のパノラマを説明します。 これは、攻撃のクラスを無力化し、マルウェアが軍拡競争で上位に入らないという新しい保護機能の研究と開発に向けた取り組みを推進します。

### <a name="exploits"></a>エクスプロイト

**ファイル** ベース (Type III: 実行可能ファイル、Flash、Java ドキュメント): 最初のファイルは、オペレーティング システム、ブラウザー、Java エンジン、フラッシュ エンジンなどを悪用してシェルコードを実行し、メモリ内にペイロードを配信する場合があります。 ペイロードはファイルレスですが、最初のエントリ ベクトルはファイルです。

**ネットワーク ベース** (Type I): ターゲット コンピューターの脆弱性を利用するネットワーク通信では、アプリケーションまたはカーネルのコンテキストでコードが実行される可能性があります。 たとえば WannaCry は、SMB プロトコルで以前に修正された脆弱性を悪用して、カーネル メモリ内にバックドアを提供します。

### <a name="hardware"></a>ハードウェア

**デバイス ベース** (タイプ I: ネットワーク カード、ハード ディスク): ハード ディスクやネットワーク カードのようなデバイスでは、チップセットと専用ソフトウェアが機能する必要があります。 デバイスのチップセットに存在するソフトウェアと実行しているソフトウェアは、ファームウェアと呼ばれる。 複雑なタスクですが、数式エスピネージ グループが検出されたので、ファームウェアはマルウェアに [感染する可能性があります](https://www.kaspersky.com/blog/equation-hdd-malware/7623/)。

**CPU ベース** (Type I): モダン CPU は複雑で、管理目的でファームウェアを実行するサブシステムを含む場合があります。 このようなファームウェアはハイジャックに対して脆弱であり、CPU 内で動作する悪意のあるコードを実行できる可能性があります。 2017 年 12 月、2 人の研究者が、Intel の最新の CPU に存在する管理エンジン [(ME)](https://en.wikipedia.org/wiki/Intel_Management_Engine) 内でコードを実行できる脆弱性を報告しました。 一方、攻撃者グループの PLATINUM は、インストールされているオペレーティング システムをバイパスして、Intel の [Active Management Technology (AMT)](https://en.wikipedia.org/wiki/Intel_Active_Management_Technology) を使用[](https://cloudblogs.microsoft.com/microsoftsecure/2017/06/07/platinum-continues-to-evolve-find-ways-to-maintain-invisibility/)して目に見えないネットワーク通信を実行する機能を持っているのが確認されています。 ME と AMT は、基本的に CPU 内に住み、非常に低いレベルで動作する自律型マイクロ コンピューターです。 これらのテクノロジの目的は、リモート管理性を提供するために、ハードウェアに直接アクセスし、オペレーティング システムとは独立し、コンピューターがオフになっても実行できます。

ファームウェア レベルで脆弱である以外に、バックドアをハードウェア回路に直接挿入して CPU を製造することもできます。 この攻撃は、 [過去に調査され、可能であることが](https://www.emsec.rub.de/media/crypto/veroeffentlichungen/2015/03/19/beckerStealthyExtended.pdf) 証明されています。 x86 プロセッサの特定のモデルには、通常のアプリケーションが特権的な実行を得るバックドアを効果的に提供できる[](https://www.theregister.co.uk/2018/08/10/via_c3_x86_processor_backdoor/)セカンダリ埋め込み RISC のような CPU コアが含まれていると報告されています。

**USB ベース** (Type I): あらゆる種類の USB デバイスは、悪意のある方法でオペレーティング システムと対話できる悪意のあるファームウェアを使用して再プログラムできます。 たとえば、 [BadUSB](https://arstechnica.com/information-technology/2014/07/this-thumbdrive-hacks-computers-badusb-exploit-makes-devices-turn-evil/) 手法を使用すると、再プログラミングされた USB スティックをキーボードとして機能し、キーストロークを介してコンピューターにコマンドを送信したり、トラフィックを自動的にリダイレクトできるネットワーク カードとして機能することができます。

**BIOS ベース** (Type I): BIOS は、チップセット内で実行されるファームウェアです。 コンピューターの電源がオンになっているときに実行され、ハードウェアが初期化され、制御がブート セクターに転送されます。 BIOS は、低レベルで動作し、ブート セクターの前に実行される重要なコンポーネントです。 [Mebromi](https://www.webroot.com/blog/2011/09/13/mebromi-the-first-bios-rootkit-in-the-wild/) ルートキットで過去に起こったのと同様に、悪意のあるコードを使用して BIOS ファームウェアを再プログラムすることができます。

**ハイパーバイザ ベース** (Type I): モダン CPU はハードウェア ハイパーバイザーのサポートを提供し、オペレーティング システムが堅牢な仮想マシンを作成できます。 仮想マシンは、限られたシミュレートされた環境で実行され、エミュレーションを知る理論上は知り得ない。 コンピューターを引き継ぐマルウェアは、実行中のオペレーティング システムの領域外に自分自身を非表示にする小さなハイパーバイザーを実装する場合があります。 この種のマルウェアは、過去に種の情報化され、最終的に実際のハイパーバイザールート[](http://seclists.org/fulldisclosure/2017/Jun/29)キットが観察されましたが、これまで知られているものは少ないものです。

### <a name="execution-and-injection"></a>実行と挿入

**ファイル ベース** (Type III: 実行可能ファイル、DLL、LNK ファイル、スケジュールされたタスク): これは標準的な実行ベクトルです。 単純な実行可能ファイルは、メモリ内で追加のペイロードを実行する第 1 段階のマルウェアとして起動したり、他の正当な実行中のプロセスに挿入することができます。

**マクロ ベース** (Type III: Office ドキュメント): [VBA](/office/vba/Library-Reference/Concepts/getting-started-with-vba-in-office) 言語は、編集タスクを自動化し、ドキュメントに動的機能を追加するように設計された柔軟で強力なツールです。 そのため、攻撃者によって悪用され、実行可能ペイロードのデコード、実行、挿入などの悪意のある操作を実行したり、 [qkG](https://blog.trendmicro.com/trendlabs-security-intelligence/qkg-filecoder-self-replicating-document-encrypting-ransomware/) のようにランサムウェア全体を実装したりする可能性があります。 マクロは、Officeプロセス (Winword.exe など) のコンテキスト内で実行され、スクリプト言語で実装されます。 ウイルス対策が検査できるバイナリ実行可能ファイルはありません。 アプリOfficeドキュメントからマクロを実行するユーザーからの明示的な同意が必要ですが、攻撃者はソーシャル エンジニアリング手法を使用して、ユーザーを騙してマクロの実行を許可します。

**スクリプト** ベース (タイプ II: ファイル、サービス、レジストリ、WMI リポジトリ、シェル): JavaScript、VBScript、および PowerShell のスクリプト言語は、Windows プラットフォームで既定で使用できます。 スクリプトはマクロと同じ利点を持ち、テキスト ファイル (バイナリ実行可能ファイルではない) であり、インタプリタ (wscript.exe、powershell.exe など) のコンテキスト内で実行されます。これはクリーンで正当なコンポーネントです。 スクリプトは汎用性が高く、ファイルから (ダブルクリックして) 実行するか、インタプリタのコマンド ラインで直接実行できます。 コマンド ラインで実行すると、マルウェアは悪意のあるスクリプトを[、WMI](https://www.fireeye.com/blog/threat-research/2017/03/dissecting_one_ofap.html) リポジトリからの [](https://www.gdatasoftware.com/blog/2014/07/23947-poweliks-the-persistent-malware-without-a-file) WMI イベント サブスクリプションとして自動実行レジストリ キー内の自動起動サービスとしてエンコードできます。 さらに、感染したコンピューターにアクセスした攻撃者は、コマンド プロンプトでスクリプトを入力する可能性があります。

**ディスク ベース** (タイプ II: ブート レコード): ブート レコードはディスクまたはボリュームの最初のセクターであり、オペレーティング システムのブート プロセスを開始するために必要な実行可能コードが含まれます。 [Petya のような脅威](https://cloudblogs.microsoft.com/microsoftsecure/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/?source=mmpc)は、悪意のあるコードで上書きすることでブート レコードに感染できます。 コンピューターが起動すると、マルウェアはすぐに制御を受け取ります。 ブート レコードはファイル システムの外部に存在しますが、オペレーティング システムからアクセスできます。 最新のウイルス対策製品には、スキャンと復元を行う機能があります。

## <a name="defeating-fileless-malware"></a>ファイルレス マルウェアを倒す

Microsoft では、セキュリティ環境を積極的に監視して、新しい脅威の傾向を特定し、脅威のクラスを軽減するためのソリューションを開発しています。 幅広い脅威に対して有効な永続的な保護をインストルメントします。 AntiMalware Scan Interface (AMSI)、動作監視、メモリ スキャン、ブート セクター保護を通じて、 [Microsoft Defender for Endpoint](/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint) は、難読化が重くてもファイルレスの脅威を検査できます。 クラウド内の機械学習テクノロジを使用すると、新しい脅威や新しい脅威に対してこれらの保護を拡張できます。

詳細については、「目に見えないが見えない:動作監視、AMSI、次世代 AV でファイルレス マルウェアを倒す」を[参照してください](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)。

## <a name="additional-resources-and-information"></a>その他のリソースと情報

脅威保護機能[を複数のユーザーに展開するMicrosoft 365 E5](/microsoft-365/solutions/deploy-threat-protection)。
