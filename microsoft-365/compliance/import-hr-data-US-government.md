---
title: 米国政府機関のクラウドに HR データをインポートするコネクタをセットアップする
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
ROBOTS: NOINDEX, NOFOLLOW
description: 米国政府機関クラウドの管理者は、組織の人事 (HR) システムから従業員データをインポートするデータ コネクタをMicrosoft 365。 これにより、内部リスク管理ポリシーで人事データを使用して、組織に内部的な脅威を与える可能性のある特定のユーザーによるアクティビティを検出できます。
ms.openlocfilehash: a8edc80d9663165608a23d3d3e03fbd6c57933f8
ms.sourcegitcommit: c2d752718aedf958db6b403cc12b972ed1215c00
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/26/2021
ms.locfileid: "58574209"
---
# <a name="set-up-a-connector-to-import-hr-data-in-us-government"></a>米国政府機関で人事データをインポートするコネクタをセットアップする

人事 (HR) データを米国政府機関にインポートMicrosoft 365 コンプライアンス センターデータ コネクタをセットアップできます。 人事関連のデータには、従業員が辞職を提出した日付と、従業員の最終日の日付が含まれます。 この人事データは、Microsoft の情報保護 リスク管理ソリューションなどの Microsoft の情報保護 ソリューションで使用[](insider-risk-management.md)して、組織内の悪意のあるアクティビティやデータの盗難から組織を保護できます。 HR コネクタのセットアップは、コネクタによる認証に使用される Azure Active Directory でアプリを作成し、人事データを含む CSV マッピング ファイルを作成し、コンプライアンス センターでデータ コネクタを作成し、CSV ファイル内の HR データを Microsoft クラウドに取り込むスクリプト (スケジュールに基づいて) を実行します。 その後、データ コネクタはインサイダー リスク管理ツールによって使用され、米国政府機関にインポートされた人事データMicrosoft 365アクセスします。

## <a name="before-you-begin"></a>はじめに

- 手順 3 で HR コネクタを作成するユーザーには、メールボックスのインポート エクスポートの役割が割り当てられている必要Exchange Online。 既定では、この役割は Exchange Online のどの役割グループにも割り当てられていません。 [メールボックスのインポートエクスポート] 役割は、組織の [組織の管理] 役割グループに追加Exchange Online。 または、新しい役割グループを作成し、メールボックスインポートエクスポートの役割を割り当て、適切なユーザーをメンバーとして追加できます。 詳細については、「グループ内の[役割グループを](/Exchange/permissions-exo/role-groups#create-role-groups)管理[](/Exchange/permissions-exo/role-groups#modify-role-groups)する」の「役割グループの作成」または「役割グループの変更」セクションを参照Exchange Online。

- 組織の人事システムから (定期的に) データを取得またはエクスポートする方法を決定し、手順 2 で説明する CSV ファイルに追加する必要があります。 手順 4 で実行するスクリプトは、CSV ファイル内の HR データを Microsoft クラウドにアップロードします。

- 手順 4 で実行したサンプル スクリプトは、人事データを Microsoft クラウドにアップロードして、インサイダー リスク管理ソリューションなど、他の Microsoft ツールで使用できます。 このサンプル スクリプトは、Microsoft 標準サポート プログラムまたはサービスではサポートされていません。 サンプル スクリプトは現状のまま提供され、いかなる保証も伴いません。 さらに、Microsoft は、商品性、特定目的への適合性の黙示の保証を含む、一切の黙示の保証をいたしかねます。 本サンプル スクリプトおよびドキュメントの使用または性能に起因するすべてのリスクは、お客様が負うものとします。 サンプル スクリプトおよびドキュメントを使用したこと、または使用できなかったことに伴って生じるいかなる損害 (業務利益の損失、業務の中断、業務情報の損失、金銭上の損失、その他一切の損害) についても、Microsoft、Microsoft に帰属する作者、スクリプトの作成、製造、または納入に関与したその他のすべての人員は、いかなる場合も責めを負わないものとします。

## <a name="step-1-create-an-app-in-azure-active-directory"></a>手順 1: アプリをアプリで作成Azure Active Directory

最初の手順は、新しいアプリを作成し、アプリ (Azure Azure Active Directory) に登録AD。 アプリは、手順 3 で作成した HR コネクタに対応します。 このアプリを作成すると、Azure ADが実行され、組織にアクセスしようとするときに HR コネクタを認証できます。 このアプリは、手順 4 で実行したスクリプトを認証して、人事データを Microsoft クラウドにアップロードするためにも使用されます。 この Azure ADアプリの作成中に、必ず次の情報を保存してください。 これらの値は、後の手順で使用されます。

- Azure ADアプリケーション ID (アプリ *ID* またはクライアント *ID とも呼ばれる*)

- Azure AD アプリケーション シークレット (クライアント シークレットとも *呼ばれる*)

- テナント ID (ディレクトリ *ID とも呼ばれる*)

Azure AD でアプリを作成する手順については、「アプリケーションをアプリに登録する」[を参照](/azure/active-directory/develop/quickstart-register-app)Microsoft ID プラットフォーム。

## <a name="step-2-prepare-a-csv-file-with-your-hr-data"></a>手順 2: 人事データを使用して CSV ファイルを準備する

次の手順では、組織を離した従業員に関する情報を含む CSV ファイルを作成します。 「Before You Begin」セクションで説明したように、組織の人事システムからこの CSV ファイルを生成する方法を決定する必要があります。 次の例は、3 つの必須パラメーター (列) を含む完成した CSV ファイル (メモ パッドで開く) を示しています。 ファイル内の CSV ファイルを編集する方がMicrosoft Excel。

```text
EmailAddress,TerminationDate,LastWorkingDate
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30
pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540
```

CSV ファイルの最初の行 (ヘッダー行) には、必要な列名が一覧表示されます。 各列ヘッダーで使用される名前は、ユーザーが使用します (前の例の名前は候補です)。 ただし、手順 3 で HR コネクタを作成する場合は、CSV ファイルで使用する列名と同じ名前を指定する必要があります。 列名にスペースを含めることはできません。

次の表に、CSV ファイル内の各列について説明します。

| 列名 | 説明 |
|:-----|:-----|
| **EmailAddress** <br/> |終了した従業員の電子メール アドレスを指定します。|
| **TerminationDate** <br/> |ユーザーの雇用が組織で正式に終了した日付を指定します。 たとえば、この日付は、従業員が組織を離れる通知を出した日付です。 この日付は、その人の最終作業日の日付とは異なる場合があります。 次の日付形式を使用 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` します。これは [ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
|**LastWorkingDate**|終了した従業員の作業の最終日を指定します。 次の日付形式を使用 `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` します。これは [ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
|||

必要な HR データを含む CSV ファイルを作成した後、手順 4 で実行したスクリプトと同じシステムに保存します。 CSV ファイルに常に最新の情報が含まれるので、更新戦略を実装してください。 これにより、スクリプトを実行した場合でも、最新の従業員終了データが Microsoft クラウドにアップロードされます。

## <a name="step-3-create-the-hr-connector"></a>手順 3: HR コネクタを作成する

次の手順では、HR コネクタを作成します。Microsoft 365 コンプライアンス センター。 手順 4 でスクリプトを実行すると、作成する HR コネクタが CSV ファイルから組織に HR データMicrosoft 365されます。 この手順では、コネクタの作成時に生成されるジョブ ID を必ずコピーしてください。 スクリプトの実行時にジョブ ID を使用します。

1. に移動 [https://compliance.microsoft.com](https://compliance.microsoft.com) し、左側の **ナビゲーションで [** データ コネクタ] をクリックします。

2. [人事]**の [データ コネクタ] ページ****で、[表示**] を **クリックします**。

3. [人事] **ページで、[** コネクタの追加 **] をクリックします**。

4. [認証資格情報 **] ページで、** 次の操作を行い、[次へ] を **クリックします**。

   1. 手順 1 で作成AD Azure アプリの Azure アプリケーション ID を入力または貼り付けます。

   1. HR コネクタの名前を入力します。

5. [ファイル **マッピング] ページ** で、手順 2 で作成した CSV ファイルの 3 つの列ヘッダー ( *パラメーターとも呼* ばれる) の名前を、それぞれの適切なボックスに入力します。 名前の大文字と小文字は区別されません。 前に説明したように、これらのボックスに入力する名前は、CSV ファイル内のパラメーター名と一致する必要があります。 たとえば、次のスクリーンショットは、手順 2 に示すサンプル CSV ファイルの例のパラメーター名を示しています。

   ![列見出し名は、CSV ファイル内の列見出しと一致します。](../media/HRConnectorWizard3.png)

6. [確認 **] ページで** 設定を確認し、[完了] を **クリックして** コネクタを作成します。

   コネクタが作成されたのを確認する状態ページが表示されます。 このページには、HR データをアップロードするためにサンプル スクリプトを実行する次の手順を完了するために必要な 2 つの重要な点が含まれている。

   ![ジョブ ID を含むページを確認し、サンプル スクリプトの github にリンクします。](../media/HRConnector_Confirmation.png)

   1. **ジョブ ID。** 次の手順でスクリプトを実行するには、このジョブ ID が必要です。 このページまたはコネクタ のフライアウト ページからコピーできます。
   
   1. **サンプル スクリプトへのリンク。** サンプル スクリプト **にアクセス** するには、GitHubリンクをクリックします (リンクによって新しいウィンドウが開きます)。 手順 4 でスクリプトをコピーできるよう、このウィンドウを開いた状態にしてください。 または、手順 4 でもう一度アクセスできるよう、リンク先をブックマークするか、URL をコピーすることもできます。 このリンクは、コネクタ のフライアウト ページでも使用できます。

7. **[完了]** をクリックします。

   新しいコネクタが [コネクタ] タブの一覧 **に表示** されます。 

8. 作成した HR コネクタをクリックして、コネクタに関するプロパティや他の情報を含むフライアウト ページを表示します。

   ![新しい HR コネクタのフライアウト ページ。](../media/HRConnectorWizard7.png)

   まだ実行していない場合は **、Azure App ID** と Connector ジョブ ID の値 **をコピーできます**。 次の手順でスクリプトを実行するには、これらを実行する必要があります。 スクリプトは、フライアウト ページからダウンロードすることもできます (または、次の手順のリンクを使用してダウンロードすることもできます)。

   [編集] を **クリック** して、Azure App ID または [ファイル マッピング] ページで定義した列ヘッダー名 **を変更** することもできます。

## <a name="step-4-run-the-sample-script-to-upload-your-hr-data"></a>手順 4: サンプル スクリプトを実行して HR データをアップロードする

HR コネクタをセットアップする最後の手順は、CSV ファイル (手順 2 で作成した) の HR データを Microsoft クラウドにアップロードするサンプル スクリプトを実行することです。 具体的には、スクリプトはデータを HR コネクタにアップロードします。 スクリプトを実行すると、手順 3 で作成した HR コネクタが人事データを Microsoft 365 組織にインポートし、Insider リスク管理ソリューションなどの他のコンプライアンス ツールからアクセスできます。 スクリプトを実行した後、タスクをスケジュールして毎日自動的に実行し、最新の従業員終了データが Microsoft クラウドにアップロードされるのを検討してください。 「スクリプト [を自動的に実行するスケジュールを設定する」を参照してください](#optional-step-6-schedule-the-script-to-run-automatically)。

1. 前の手順で開いたウィンドウに移動し、サンプル スクリプトを使用してGitHubサイトにアクセスします。 または、ブックマークされたサイトを開くか、コピーした URL を使用します。

2. [Raw] **ボタンを** クリックして、スクリプトをテキスト ビューに表示します。

3. サンプル スクリプト内のすべての行をコピーし、テキスト ファイルに保存します。

4. 必要に応じて、組織のサンプル スクリプトを変更します。

5. ファイル名のサフィックスを使用Windows PowerShellスクリプト ファイルとしてテキスト ファイルを保存します `.ps1` 。たとえば、 `HRConnector.ps1` 。

6. ローカル コンピューターでコマンド プロンプトを開き、スクリプトを保存したディレクトリに移動します。

7. 次のコマンドを実行して、CSV ファイル内の HR データを Microsoft クラウドにアップロードします。例えば：

    ```powershell
    .\HRConnector.ps1 -tenantId <tenantId> -appId <appId>  -appSecret <appSecret>  -jobId <jobId>  -csvFilePath '<csvFilePath>'
    ```

   次の表では、このスクリプトで使用するパラメーターとその必要な値について説明します。 前の手順で取得した情報は、これらのパラメーターの値で使用されます。

   | パラメーター | 説明 |
   |:-----|:-----|:-----|
   |`tenantId`|手順 1 で取得Microsoft 365組織の ID。 組織のテナント ID は、Azure 管理センターの [概要] ブレードADすることもできます。 これは、組織を識別するために使用されます。|
   |`appId` |Azure ADで作成したアプリのアプリケーション ID は、手順 1 AD参照してください。 これは、スクリプトが組織ADアクセスしようとするときに、Azure Microsoft 365によってMicrosoft 365されます。 |
   |`appSecret`|Azure ADで作成したアプリのアプリケーション シークレットは、手順 1 AD参照してください。 これは、認証にも使用されます。|
   |`jobId`|手順 3 で作成した HR コネクタのジョブ ID。 これは、Microsoft クラウドにアップロードされた HR データを HR コネクタに関連付ける場合に使用します。|
   |`csvFilePath`|手順 2 で作成した CSV ファイル (スクリプトと同じシステムに格納されている) のファイル パス。 ファイル パス内のスペースを避けるようにします。それ以外の場合は、単一引用符を使用します。|
   |||
   
   各パラメーターの実際の値を使用する HR コネクタ スクリプトの構文の例を次に示します。

   ```powershell
    .\HRConnector.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv'
    ```

   アップロードが成功した場合、スクリプトは成功したメッセージアップロード **表示** します。

   > [!NOTE]
   > 実行ポリシーのために前のコマンドを実行する際に問題がある場合は、「実行[](/powershell/module/microsoft.powershell.core/about/about_execution_policies)ポリシーについて」および[「Set-ExecutionPolicy」](/powershell/module/microsoft.powershell.security/set-executionpolicy)を参照して、実行ポリシーの設定に関するガイダンスを参照してください。

## <a name="step-5-monitor-the-hr-connector"></a>手順 5: HR コネクタを監視する

HR コネクタを作成し、スクリプトを実行して HR データをアップロードした後、コネクタを表示し、そのコネクタの状態をアップロードMicrosoft 365 コンプライアンス センター。 スクリプトを定期的に自動的に実行するスケジュールを設定した場合は、前回スクリプトを実行した後に現在の状態を表示することもできます。

1. 左側の [https://compliance.microsoft.com](https://compliance.microsoft.com) ナビゲーションで [ **データ コネクタ] に** 移動してクリックします。

2. [コネクタ **] タブをクリック** し、HR コネクタを選択して、フライアウト ページを表示します。 このページには、コネクタに関するプロパティと情報が含まれる。

   ![プロパティと状態を含む HR コネクタ のフライアウト ページ。](../media/HRConnectorFlyout1.png)

3. [ **進行状況]** で、[ログのダウンロード **] リンクを** クリックして、コネクタの状態ログを開く (または保存) します。 このログには、スクリプトが実行され、CSV ファイルから Microsoft クラウドにデータをアップロードする度に関する情報が含まれます。 

   ![HR コネクタ ログ ファイルには、アップロードされた CSV ファイルの番号行が表示されます。](../media/HRConnectorLogFile.png)

   この `RecordsSaved` フィールドは、アップロードされた CSV ファイル内の行数を示します。 たとえば、CSV ファイルに 4 行が含まれている場合、スクリプトが CSV ファイル内のすべての行を正常にアップロードした場合、フィールドの値は `RecordsSaved` 4 になります。

手順 4 でスクリプトを実行していない場合、スクリプトをダウンロードするリンクが [最後のインポート] の下 **に表示されます**。 スクリプトをダウンロードし、手順 4 の手順に従って実行できます。

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>(省略可能)手順 6: スクリプトを自動的に実行するスケジュールを設定する

組織の最新の人事データをインサイダー リスク管理ソリューションなどのツールで利用するには、スクリプトを 1 日に 1 回など定期的に自動的に実行するようにスケジュールすることをお勧めします。 また、CSV ファイル内の HR データを同様のスケジュール (同じではない場合) に更新して、組織を離れる従業員に関する最新情報が含まれる必要があります。 目標は、最新の人事データをアップロードして、HR コネクタがインサイダー リスク管理ソリューションで利用できるようすることです。

タスク スケジューラ アプリを使用すると、Windowsスクリプトを自動的に実行できます。

1. ローカル コンピューターで、[スタート] ボタンをクリックWindows **タスク** スケジューラと **入力します**。

2. タスク スケジューラ **アプリをクリック** して開きます。

3. [アクション] **セクションで** 、[タスクの作成] **をクリックします**。

4. [全般 **] タブ** で、スケジュールされたタスクのわかりやすい名前を入力します。たとえば **、HR Connector Script**. オプションの説明を追加できます。

5. [セキュリティ **オプション] で**、次の操作を行います。

   1. コンピューターにログオンしている場合にのみスクリプトを実行するか、ログオンしていないときに実行するかどうかを決定します。
   
   1. [最高の権限で **実行する] チェック ボックスが** オンになっていることを確認します。

6. [トリガー] **タブを選択** し、[ **新規**] をクリックし、次の操作を行います。

   1. **[設定]** で [**日** 次] オプションを選択し、スクリプトを初めて実行する日時を選択します。 スクリプトは、毎日同じ指定された時刻に実行されます。
   
   1. [ **詳細設定] で**、[有効] **チェック ボックスが** オンになっていることを確認します。
   
   1. [**OK**] をクリックします。

7. [操作] **タブを** 選択し、[ **新規**] をクリックし、次の操作を行います。

   ![HR コネクタ スクリプトの新しいスケジュールされたタスクを作成するアクション設定。](../media/HRConnectorScheduleTask1.png)

   1. [アクション **] ドロップダウン** リストで、[プログラムの開始 **] が選択されている** 必要があります。

   1. [プログラム **/スクリプト] ボックスで** 、[ **参照**] をクリックし、次の場所に移動して選択して、パスがボックスに表示されます `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe` 。

   1. [引数 **の追加 (オプション)]** ボックスに、手順 4 で実行したのと同じスクリプト コマンドを貼り付けます。 たとえば、`.\HRConnector.ps1 -tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn"  -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -csvFilePath "C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv"` のように指定します。

   1. [スタート **] (オプション) ボックス** に、手順 4 で実行したスクリプトのフォルダーの場所を貼り付けます。 たとえば、`C:\Users\contosoadmin\Desktop\Scripts` などです。

   1. **[OK] を** クリックして、新しいアクションの設定を保存します。

8. [タスクの **作成] ウィンドウで****、[OK] をクリックして**、スケジュールされたタスクを保存します。 ユーザー アカウントの資格情報の入力を求めるメッセージが表示される場合があります。

   新しいタスクがタスク スケジューラ ライブラリに表示されます。

   ![新しいタスクがタスク スケジューラ ライブラリに表示されます。](../media/HRConnectorTaskSchedulerLibrary.png)

   スクリプトが最後に実行された時刻と、次回の実行がスケジュールされている時間が表示されます。 タスクをダブルクリックして編集できます。

   コンプライアンス センターの対応する HR コネクタのフライアウト ページでスクリプトが最後に実行された時刻を確認することもできます。